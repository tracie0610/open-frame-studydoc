var CNP_NAME_UNKNOWN="\uff08\u6ca1\u6709\u540d\u79f0\uff09",CNP_STATUS_BLOCKED="\u5df2\u963b\u6b62",CNP_STATUS_BUSY="\u5fd9\u788c",CNP_STATUS_BUSY_SENDTOOLTIP="\uff08\u5fd9\u788c\uff09\u5355\u51fb\u4ee5\u53d1\u9001\u5373\u65f6\u6d88\u606f",CNP_STATUS_AWAY="\u79bb\u5f00",CNP_STATUS_AWAY_SENDTOOLTIP="\uff08\u79bb\u5f00\uff09\u5355\u51fb\u4ee5\u53d1\u9001\u5373\u65f6\u6d88\u606f",CNP_STATUS_BE_RIGHT_BACK="\u9a6c\u4e0a\u56de\u6765",CNP_STATUS_BE_RIGHT_BACK_SENDTOOLTIP="\uff08\u9a6c\u4e0a\u56de\u6765\uff09\u5355\u51fb\u4ee5\u53d1\u9001\u5373\u65f6\u6d88\u606f",CNP_STATUS_ON_THE_PHONE="\u901a\u8bdd\u4e2d",CNP_STATUS_ON_THE_PHONE_SENDTOOLTIP="\uff08\u901a\u8bdd\u4e2d\uff09\u5355\u51fb\u4ee5\u53d1\u9001\u5373\u65f6\u6d88\u606f",CNP_STATUS_OUT_TO_LUNCH="\u5916\u51fa\u5c31\u9910",CNP_STATUS_OUT_TO_LUNCH_SENDTOOLTIP="\uff08\u5916\u51fa\u5c31\u9910\uff09\u5355\u51fb\u4ee5\u53d1\u9001\u5373\u65f6\u6d88\u606f",CNP_STATUS_INVISIBLE="\u663e\u793a\u4e3a\u8131\u673a",CNP_STATUS_ONLINE="\u8054\u673a",CNP_STATUS_ONLINE_SENDTOOLTIP="\uff08\u8054\u673a\uff09\u5355\u51fb\u4ee5\u53d1\u9001\u5373\u65f6\u6d88\u606f",CNP_STATUS_OFFLINE="\u8131\u673a",CNP_STATUS_OFFLINE_SENDTOOLTIP="\uff08\u8131\u673a\uff09\u5355\u51fb\u4ee5\u53d1\u9001\u5373\u65f6\u6d88\u606f",CNP_SET_LIVECONTACT="\u8ba2\u9605\u66f4\u65b0\u8054\u7cfb\u4fe1\u606f",CNP_VIEW_SPACE="\u67e5\u770b\u5171\u4eab\u7a7a\u95f4",CNP_VIEW_PROFILE="\u67e5\u770b\u4e2a\u4eba\u8d44\u6599",CNP_SEND_IM="\u53d1\u9001\u5373\u65f6\u6d88\u606f",CNP_ADD_TO_MYSOCIALNETWORK="\u9080\u8bf7\u6210\u4e3a\u670b\u53cb",CNP_VIEW_SOCIAL_NETWORK="\u67e5\u770b\u670b\u53cb\u5217\u8868",CNP_INVITE_TO_MYBUDDYLIST="\u9080\u8bf7\u6210\u4e3a Messenger \u8054\u7cfb\u4eba",CNP_CONFIRMATION_INVITE_TO_BUDDYLIST="\u5df2\u5411 {0} \u53d1\u9001\u4e86\u4e00\u4e2a\u6210\u4e3a Messenger \u8054\u7cfb\u4eba\u7684\u9080\u8bf7\u3002",CNP_CONFIRMATION_ADD_TO_MY_SOCIALNETWORK="\u5df2\u7ecf\u5c06\u6b64\u4eba\u6dfb\u52a0\u81f3\u670b\u53cb\u5217\u8868\uff0c\u5e76\u5df2\u53d1\u9080\u8bf7\u81f3 {0}\u3002",CNP_SN_TYPE_DISPLAY_NAME="\u8bf7\u4e3a\u6b64\u8054\u7cfb\u4eba\u952e\u5165\u540d\u5b57\uff1a",CNP_GLEAM_ICON_TOOLTIP="\u67e5\u770b\u65b0\u4fe1\u606f",CNP_EP_VIEW_RECENT_ACTIVITY="\u67e5\u770b\u6700\u8fd1\u7684\u6d3b\u52a8";registerNamespace("Live.Spaces.IdentityControl");var __IdCtrlNs=Live.Spaces.IdentityControl;__IdCtrlNs.ItemStatus=new $Enum("None","Pending","Decrypting","Retrieved");registerNamespace("Live.Spaces.IdentityControl.Presence");__IdCtrlNs.Presence.State=new $Flags("Offline",0,"Online",1,"Invisible",2,"Busy",3,"BeRightBack",4,"Idle",5,"Away",6,"OnThePhone",7,"OutToLunch",8);__IdCtrlNs.Presence.ConnectionState=new $Flags("SignedIn",0,"SignedOut",1,"SigningIn",2,"SigningOut",3);__IdCtrlNs.Presence.BuddyListType=new $Flags("ForwardList",1,"AllowList",2,"BlockList",4,"ReverseList",8,"PendingList",16);$Network.registerFpp("ICSrv",function(){var e=$Network.FppProxy,a=e.__string,c=e.__primitive,h=e.__array,i=e.__custom,g=e.__enum,d=e.__date,f=e.__object,j=e.__oArray,b=new $Network.FppProxy("ICSrv");b.rfc("AB",[c("Flg"),h("Cs"),h("PpDIs"),a("PMNe"),f("Friends")]);b.CntType=new $Flags("Reg",0,"Me",1,"L",2,"LD",3,"LP",4,"LR",5);b.rfc("Cnt",[a("Cid"),a("PMN"),a("Fn"),a("Ln"),c("IsMsgr"),g("CT")]);b.rfc("MktCap",[c("IsMessengerEnabled"),c("IsLegacyMessengerEnabled")]);b.rfc("ND",[a("ST"),a("FId"),a("Rss"),c("HA"),d("LV"),d("LC"),c("G")]);b.rfc("PpDI",[a("Cid"),c("HSA"),d("SLC"),d("SLV"),c("SG"),c("HPA"),d("PLC"),d("PLV"),c("PG"),c("HCPA"),d("CPLC"),d("CPLV"),h("FS")]);b.rfc("CidD",[a("Cid"),a("D")]);b.rfc("AbNSet",[i(b.AB,"AB"),i(b.MktCap,"Set")]);b.FppStatus=new $Flags("SUCCESS",0,"ERR_HTTP_MISCONFIGURATION",-7,"ERR_HTTP_PARSE_FAILURE",-6,"ERR_HTTP_CONNECT_FAILURE",-5,"ERR_HTTP_TIMEOUT",-4,"ERR_SERVER_UNCAUGHT",-3,"ERR_APP_SPECIFIC",-2,"ERR_FPP_PROTOCOL",-1);b.rfc("FppError",[a("ErrorCode"),a("Message"),f("ErrorObj"),a("StackTrace")]);b.rfc("FppReturnPackage",[g("Status"),f("Value"),j("OutRefParams"),i(b.FppError,"Error"),f("ProfilingInfo")]);b.FppCommandType=new $Flags("FPP",0,"FPP_JSON",1,"FPP_RP",2,"FPP_RP_JSON",3);b.FppVersion=new $Flags("BASE",0,"ONE",1,"TWO",2,"CURRENT",2);b.rfc("FppProxySettings",[g("Version"),g("CommandType"),a("PartnerId"),a("SessionId"),a("AuthUser"),a("ServerTunnelingUrl"),c("UseClientXmlProxy"),a("CanaryToken"),c("DefaultRetry"),c("Notify"),g("DateType")]);b.FppDateType=new $Flags("Local",0,"UTC",1);b.rfm("getmarketcapability",[a("market")],"getmarketcapability",$Network.Type.XMLGet,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");b.rfm("getaddressbook",[a("market"),a("cid"),f("apiParams"),a("cacheBuster")],"getaddressbook",$Network.Type.XMLGet,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");b.rfm("getaddressbookandsettings",[a("market"),a("cid"),f("apiParams"),a("cacheBuster")],"getaddressbookandsettings",$Network.Type.XMLGet,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");b.rfm("decryptpassportmembernames",[a("encryptedData")],"decryptpassportmembernames",$Network.Type.XMLPost,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");b.rfm("addtosocialnetwork",[a("contactCid"),c("tryJoinContactsNetwork"),c("addToBuddyList"),a("firstName"),a("lastName"),a("displayName"),a("market")],"addtosocialnetwork",$Network.Type.XMLPost,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");b.rfm("invitetomessenger",[a("contactCid"),a("market")],"invitetomessenger",$Network.Type.XMLPost,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");b.rfm("requestlivecontact",[a("contactCid"),a("market")],"requestlivecontact",$Network.Type.XMLPost,null,"Microsoft.Spaces.Services.IdentityControlFpp.IdentityControlFppService");b.seal();return b});$Network.registerFpp("CardSvc",function(){var d=$Network.FppProxy,a=d.__string,e=d.__primitive,j=d.__array,f=d.__custom,g=d.__enum,c=d.__date,h=d.__object,i=d.__oArray,b=new $Network.FppProxy("CardSvc");b.IdType=new $Flags("Contact",0);b.rfc("Request",[g("IdType"),a("Id"),a("Partner"),a("Market"),f(b.Stamps,"Timestamps")]);b.rfc("Stamps",[e("UpdateTimestamps"),c("SLV"),c("SLC"),c("PLV"),c("PLC"),c("CPLV"),c("CPLC"),c("LCPLC"),c("ELC"),a("GM"),j("Notifs")]);b.rfc("Notif",[a("ServiceType"),a("ForeignId"),a("RssUrl"),c("LV"),c("LC"),e("Gleam")]);b.rfc("Request2",[g("IdType"),a("Id"),a("Partner"),a("Market"),f(b.Stamps,"Timestamps"),e("OpenLinksInNewWindow")]);b.rfc("FeedResponse",[a("HeadHtml"),a("BodyHtml"),f(b.Style,"Style"),a("HeadHtml2"),a("BodyHtml2"),f(b.Style2,"Style2")]);b.rfc("Style",[a("HTxtCl"),a("HBgCl"),a("HBgI"),a("BTxtCl"),a("BBgCl"),a("BDivCl"),a("ABgCl"),a("ALkCl")]);b.rfc("Style2",[a("HeadText"),a("HeadBkgd"),a("BodyTitle"),a("BodyPartTitle"),a("BodyText"),a("BodyBkgd"),a("ActText"),a("ActBkgd"),a("DivClr")]);b.FppStatus=new $Flags("SUCCESS",0,"ERR_HTTP_MISCONFIGURATION",-7,"ERR_HTTP_PARSE_FAILURE",-6,"ERR_HTTP_CONNECT_FAILURE",-5,"ERR_HTTP_TIMEOUT",-4,"ERR_SERVER_UNCAUGHT",-3,"ERR_APP_SPECIFIC",-2,"ERR_FPP_PROTOCOL",-1);b.rfc("FppError",[a("ErrorCode"),a("Message"),h("ErrorObj"),a("StackTrace")]);b.rfc("FppReturnPackage",[g("Status"),h("Value"),i("OutRefParams"),f(b.FppError,"Error"),h("ProfilingInfo")]);b.FppCommandType=new $Flags("FPP",0,"FPP_JSON",1,"FPP_RP",2,"FPP_RP_JSON",3);b.FppVersion=new $Flags("BASE",0,"ONE",1,"TWO",2,"CURRENT",2);b.rfc("FppProxySettings",[g("Version"),g("CommandType"),a("PartnerId"),a("SessionId"),a("AuthUser"),a("ServerTunnelingUrl"),e("UseClientXmlProxy"),a("CanaryToken"),e("DefaultRetry"),e("Notify"),g("DateType")]);b.FppDateType=new $Flags("Local",0,"UTC",1);b.rfm("getcard",[f("request")],"getcard",$Network.Type.XMLPost,null,"MS.Msn.Spaces.Services.ContactCard.FireAnt.FeedFppService");b.rfm("getcard2",[f("request"),e("version")],"getcard2",$Network.Type.XMLPost,null,"MS.Msn.Spaces.Services.ContactCard.FireAnt.FeedFppService");b.seal();return b});__IdCtrlNs.Configs=new function(){var a=this,b;a.Partner;a.Market;a.ViewerId;a.ProxyFppUrl;a.MsgrEnabled;a.LgcyPpmMsgrEnabled;a.SpacesFD;a.IdentSvcHost;a.WLThemeUrl;a.SiteId;a.ReturnUrl;a.ReturnName;a.UxpLiveControlsBinding;a.UxpLiveStrings;a.CanaryCookieName;a.Load=function(){if(!b){var c;c=typeof __LiveIdentityControlConfig!="undefined"?__LiveIdentityControlConfig:null;a.Partner=c.PartnerId;a.Market=c.Market;a.ViewerId=new __IdCtrlNs.IdentityId(__IdCtrlNs.IdType.Contact,c.ViewerCid);a.ProxyFppUrl=c.ProxyFppUrl;a.SpacesFD=c.SpcFD;a.IdentSvcHost=c.IdentSvcHost;a.WLThemeUrl=c.WLThemeUrl;a.SiteId=c.SiteId;a.ReturnUrl=c.rurl;a.ReturnName=c.rname;a.UxpLiveControlsBinding=c.uxpLCB;a.UxpLiveStrings=c.uxpLS;a.GlobalNewWindow=c.globalNewWin==null?true:c.globalNewWin;a.CanaryCookieName=c.CanaryN;a.IdentityScriptBase=c.IdentScptBase;if(!a.WLThemeUrl.endsWith("/"))a.WLThemeUrl+="/";if(!a.SpacesFD.endsWith("/"))a.SpacesFD+="/"}};a.LoadFromServer=function(b){a.MsgrEnabled=b.IsMessengerEnabled;a.LegacyMsgrEnabled=b.IsLegacyMessengerEnabled};a.isSignedIn=function(){return a.ViewerId.GetId()!=0}};__IdCtrlNs.IdType=new $Enum("Contact","Event","Group","PartnerDefined");__IdCtrlNs.IdentityId=function(d,e){var a=this,b=d,c=e;a.IsId=function(a){return b==a.GetIdType()&&c==a.GetId()};a.GetIdType=function(){return b};a.GetId=function(){return c};a.toString=function(){return b.toString()+c};a.IsValidContact=function(){return b==__IdCtrlNs.IdType.Contact&&c!=0}};__IdCtrlNs.Utility=new function(){var a=this;a.FormatCidAsHex=function(c){var d="0123456789abcdef",h=0;if(c.charAt(0)=="-"){h=1;c=c.substr(1,c.length-1)}var a="";while(c!=""){var e="",f=0;for(var b=0;b<c.length;b+=1){var j=d.indexOf(c.charAt(b))+10*f,k=Math.floor(j/16);f=j%16;if(k!=0||e.length>0)e+=d.charAt(k)}c=e;a=d.charAt(f)+a}while(a.length<16)a="0"+a;if(h!=0){for(var b=a.length-1;b>=0;b--)a=a.substr(0,b)+d.charAt(15-d.indexOf(a.charAt(b)))+a.substr(b+1,a.length-b-1);var i=1;for(var b=a.length-1;b>=0;b--){var g=d.indexOf(a.charAt(b))+i;if(g>15)g-=16;else i=0;a=a.substr(0,b)+d.charAt(g)+a.substr(b+1,a.length-b-1)}}return a};a.IsIE7=function(){var a=$Browser.version;return a>=7&&a<8};a.GetWLThemeImageUrl=function(b,a){return b.WLThemeUrl+"spacesidentityctrl/img/"+a};a.IsInMsgr=function(){return window&&window.external&&window.external.MsgrHost};a.OpenCardLinkElm=function(a){var c=true;if(a&&a.href){__IdCtrlNs.Utility.OpenLink(a.href,a.target=="_blank");c=false;var b=window.event;if(b){b.cancelBubble=true;b.returnValue=false}}return c};a.OpenLink=function(b,h,f,i,g){if(f){var c=__IdCtrlNs.DataMgrFactory.getInstance().getConfigs(),e=c.ReturnUrl?c.ReturnUrl:window.location.href,d=c.ReturnName;if(e){if(b.indexOf("?")>0)b+="&rurl=";else b+="?rurl=";b+=encodeURIComponent(e)}if(d){if(b.indexOf("?")>0)b+="&rname=";else b+="?rname=";b+=encodeURIComponent(d)}}if(h)return a.OpenWindow(b,null,i,g);else window.location=b};a.OpenWindow=function(c,e,d,f){if(a.IsInMsgr()){if(e==null){var g=__IdCtrlNs.DataMgrFactory.getInstance().getConfigs();e=g.SiteId}a.MsgrOpenWithAuth(c,e);return null}else{var b;if(f)b=window.open(c,d,f);else if(d)b=window.open(c,d);else b=window.open(c);if(b)try{b.focus()}catch(h){}return b}};a.MsgrOpenWithAuth=function(c,d){var b,a;a=window.external;if(a){b=a.MsgrHost;if(b)b.OpenWithAuth(c,Number(d))}};a.DateIsEarlier=function(c,a){var b=false;if(null==c)b=a&&a.getUTCFullYear()>2000;else b=a&&a.getUTCFullYear()>2000&&a<c;return b};a.GetPresenceImgInfo=function(i){var j=null,k=null;if(i.Properties.HasPresenceInfo()){var b=__IdCtrlNs.Presence.State;if(a.PresenceImgs==null){var f=a.GetWLThemeImageUrl,g=__IdCtrlNs.Configs,c=a.PresenceImgs={};c[b.Offline]=f(g,"MsgrOffline.gif");c[b.Online]=f(g,"MsgrOnline.gif");c[b.OnThePhone]=c[b.Busy]=f(g,"MsgrBusy.gif");c[b.BeRightBack]=c[b.Idle]=c[b.Away]=c[b.OutToLunch]=f(g,"MsgrAway.gif")}if(a.PresenceText==null){var d=a.PresenceText={};d[b.Offline]={t:CNP_STATUS_OFFLINE,a:CNP_STATUS_OFFLINE_SENDTOOLTIP};d[b.Online]={t:CNP_STATUS_ONLINE,a:CNP_STATUS_ONLINE_SENDTOOLTIP};d[b.OnThePhone]={t:CNP_STATUS_ON_THE_PHONE,a:CNP_STATUS_ON_THE_PHONE_SENDTOOLTIP};d[b.Busy]={t:CNP_STATUS_BUSY,a:CNP_STATUS_BUSY_SENDTOOLTIP};d[b.BeRightBack]={t:CNP_STATUS_BE_RIGHT_BACK,a:CNP_STATUS_BE_RIGHT_BACK_SENDTOOLTIP};d[b.Idle]=d[b.Away]={t:CNP_STATUS_AWAY,a:CNP_STATUS_AWAY_SENDTOOLTIP};d[b.OutToLunch]={t:CNP_STATUS_OUT_TO_LUNCH,a:CNP_STATUS_OUT_TO_LUNCH_SENDTOOLTIP}}if(i.IsBlocked()){j=a.GetWLThemeImageUrl("MsgrBlocked.gif");k=action=CNP_STATUS_BLOCKED}else{var e=i.Properties.Presence.Buddy.OnlineState;if(e!=null){j=a.PresenceImgs[e];var h=a.PresenceText;if(h[e]){k=h[e].t;action=h[e].a}}}return {image:j,text:k,action:action}}return null};a.AddToMySocialNetwork=function(d){var f=__IdCtrlNs.DataMgrFactory.getInstance(),c=f.getConfigs(),e=window.location,j=e&&e.pathname&&e.pathname.toLowerCase().startsWith("/networkexplorer.aspx");if(c.isSignedIn()){var k=f.IdentMgr,h=k.GetMeContact();if(h&&h.HasSocialNetwork()){var b=d.getDisplayName();b=b!=null?b:CNP_NAME_UNKNOWN;if(b==CNP_NAME_UNKNOWN&&!a.IsIE7()){var g=window.prompt(CNP_SN_TYPE_DISPLAY_NAME,b);b=g?g:CNP_NAME_UNKNOWN}if(b&&b.trim().length>0){d.AddToMySocialNetwork("","",b);alert(CNP_CONFIRMATION_ADD_TO_MY_SOCIALNETWORK.format(b));return}}}var i=d.ContactId.GetId();a.OpenLink(c.SpacesFD+"spacesapi.aspx?wx_action=add&wx_url=%2ffriends.aspx&partner=social&size=small&cid="+i+"&mkt="+c.Market,j,false,"SN");f.IdentMgr.MarkAsFriendOrFan(i)};a.SubscribeContactUpdates=function(c){var d=__IdCtrlNs.DataMgrFactory.getInstance(),b=d.getConfigs();a.OpenLink(b.SpacesFD+"profile.aspx?action=makeactive&cid="+c.ContactId.GetId()+"&mkt="+b.Market,a.IsInMsgr(),true)};a.ShowMessengerInvitedDialog=function(a){alert(CNP_CONFIRMATION_INVITE_TO_BUDDYLIST.format(a?a:CNP_NAME_UNKNOWN))};a.CancelBubble=function(a){if(!a)a=window.event;a.cancelBubble=true;a.returnValue=false};a.CookieWrite=function(e,d,b,a,c){if(document.domain.endsWith(a))document.cookie=escape(e)+"="+escape(d)+(b?";expires="+b.toUTCString():"")+(c?";path="+c:"")+(a?";domain="+a:"")};a.CookieGetValue=function(f){var b=document.cookie,a,c=f+"=",e=b.indexOf(c);if(-1!=e){var d=b.indexOf(";",e+c.length);if(-1==d)d=b.length;a=b.substring(e+c.length,d);a=unescape(a)}return a};a.GetTimeFromNow=function(b){var a=new Date;a.setTime(a.getTime()+b*1000);return a};a.GetSharedDomain=function(a){var c=a.indexOf(":");if(c>0)a=a.substring(0,c);var b=a.split(".");if(b.length>=2)a=b[b.length-2]+"."+b[b.length-1];return a};a.decodeHtmlMarkup=function(a){return a}};var ICEPOpenLink=__IdCtrlNs.Utility.OpenCardLinkElm;__IdCtrlNs.IdentityProperties=function(d,b,c){var a=this;a.ABCH=d;a.MiniProfile=b;a.Presence=c;a.IsSetAsLiveContactPending=false;a.IsAddToMyBuddyListPending=false;a.IsAddToSocialNetworkPending=false;a.IsDynamicNoficationsResolved=false;a.HasABCHDynamicInfo=function(){return a.ABCH!=null&&a.ABCH.DI!=null};a.HasABCHDynamicInfoNotifications=function(){return a.HasABCHDynamicInfo()&&a.ABCH.DI.FS&&a.ABCH.DI.FS.length>0};a.HasABCHContactInfo=function(){return a.ABCH!=null&&a.ABCH.CI&&a.ABCH.CI.Cid!=null};a.HasDecryptedPMN=function(){var d=false;if(a.HasABCHContactInfo()){var b=a.ABCH.ContactInfo.ContactInformation;if(b){var c=b.PassportMemberNameIsEncrypted;d=b.PassportMemberName&&(typeof c=="undefined"||!c)}}return d};a.HasPresenceInfo=function(){return a.Presence!=null&&a.Presence.Buddy!=null};a.IsContactType=function(b){return a.HasABCHContactInfo()&&a.ABCH.CI.CT==b};a.IsMessengerUser=function(){return a.HasABCHContactInfo()&&a.ABCH.CI.IsMsgr};a.NotifyABCHDataUpdate=function(){a.OnABCHDataUpdate.fire(a)};a.OnABCHDataUpdate=new $Event};__IdCtrlNs.ABCHProperties=function(b,a){this.CI=b;this.DI=a};__IdCtrlNs.PresenceProperties=function(b){var a=this;a.Buddy=b;a.IsInBuddyListType=function(b){return (parseInt(a.Buddy.BuddyListType)&parseInt(b))>0}};__IdCtrlNs.IdentUpdateType=new $Flags("None",0,"ABCH",1,"Presence",2,"Other",4);__IdCtrlNs.EventData=function(b,a){this.Source=b;this.Data=a};__IdCtrlNs_Contact=__IdCtrlNs.Contact=function(j){var a=this,b={};a.ContactId=j;a.dispose=function(){if(b.cardRequestTimer!=null){window.clearTimeout(b.cardRequestTimer);b.cardRequestTimer=null}a.Properties.OnABCHDataUpdate.detach(g);a=b=a.ContactId=null};a.IsInitialized=j==null;a.CapabilityStatus=__IdCtrlNs.ItemStatus.None;var i=false;a.IsGleaming=function(){var c=false;if(!i){var f=a.Properties;if(f.HasABCHDynamicInfo()){var b=f.ABCH.DI;c=b.GleamState?true:false;if(!c&&(h(b.SG,b.SLC,b.SLV)||h(b.PG,b.PLC,b.PLV)))c=true;if(!c&&(b.HCPA&&b.CPLC&&b.CPLV&&b.CPLC>b.CPLV))c=true;if(!c&&f.HasABCHDynamicInfoNotifications()){var e=b.FS;for(var d=0;d<e.length;++d)if(e[d]&&e[d].G){c=true;break}}}}return c};var h=function(a,b,c){if(a)if(typeof b!="undefined"&&typeof c!="undefined")a=b>c;return a};a.ClearGleam=function(){i=true;a.Properties.NotifyABCHDataUpdate();a.OnContactUpdate.fire(new __IdCtrlNs.EventData(a,__IdCtrlNs.IdentUpdateType.ABCH))};a.GetViewSpaceUrl=function(h){var b=$Request.extractHost(c().SpacesFD,false);if(b.endsWith(":83")){var f=b.split(":",1);b=f[0]}var e=a.ContactId,d=0,g=e.GetIdType();if(g==__IdCtrlNs.IdType.Contact)d=e.GetId();if(d!=0)return "http://cid-"+__IdCtrlNs.Utility.FormatCidAsHex(d)+"."+b+h;return c().SpacesFD};a.IsMeContact=function(){return a.Properties.IsContactType(ICSrv.CntType.Me)||a.ContactId.IsId(__IdCtrlNs.DataMgrFactory.getInstance().getConfigs().ViewerId)};a.IsInMyLiveContact=function(){var b=a.Properties;return b.IsSetAsLiveContactPending||b.HasABCHContactInfo()&&b.ABCH.CI.CT!=ICSrv.CntType.Reg};a.IsInMySocialNetwork=function(){if(!a.ContactId.IsValidContact())return false;var b=__IdCtrlNs.DataMgrFactory.getInstance();return b.IdentMgr.IsFriendOrFan(a.ContactId.GetId())};a.IsInMyBuddyList=function(){var b=a.Properties;return b.IsAddToMyBuddyListPending||b.IsMessengerUser()};a.HasProfile=function(){var d=a.Properties,c=a.Properties.ABCH;return d.HasABCHDynamicInfo()&&(c.DI.PLC||c.DI.HPA)||b.profileName&&b.profileName.trim().length>0&&b.profileName!=CNP_NAME_UNKNOWN};a.HasSpace=function(){var b=a.Properties;return b.HasABCHDynamicInfo()&&(b.ABCH.DI.SLC||b.ABCH.DI.HSA)};a.HasSocialNetwork=function(){return a.HasSpace()};a.Properties=new __IdCtrlNs.IdentityProperties;a.ViewSocialNetwork=function(b){__IdCtrlNs.Utility.OpenLink(a.GetViewSpaceUrl("/friends"),!b,false)};a.ViewSpace=function(b){__IdCtrlNs.Utility.OpenLink(a.GetViewSpaceUrl(""),!b,false)};a.ViewRecentActivity=function(b){__IdCtrlNs.Utility.OpenLink(a.GetViewSpaceUrl("/recent/"),!b,false)};a.ViewProfile=function(a){__IdCtrlNs.Utility.OpenLink(c().SpacesFD+"profile.aspx?"+o(),!a,false)};a.AddFriend=function(){__IdCtrlNs.Utility.AddToMySocialNetwork(a)};a.AddToMySocialNetwork=function(g,h,f){var d=a.ContactId.GetId(),e=__IdCtrlNs.DataMgrFactory.getInstance();e.IdentSvc.addtosocialnetwork(d,true,false,g,h,f,c().Market,k);var b=a.Properties;b.IsAddToSocialNetworkPending=true;b.NotifyABCHDataUpdate();e.IdentMgr.MarkAsFriendOrFan(d)};a.AddToBuddyList=function(){var d=__IdCtrlNs.DataMgrFactory.getInstance();d.IdentSvc.invitetomessenger(a.ContactId.GetId(),c().Market,k);var b=a.Properties;b.IsAddToMyBuddyListPending=true;b.NotifyABCHDataUpdate();__IdCtrlNs.Utility.ShowMessengerInvitedDialog(a.getDisplayName())};a.SetAsLiveContact=function(){__IdCtrlNs.Utility.SubscribeContactUpdates(a);var b=a.Properties;b.IsSetAsLiveContactPending=true;b.NotifyABCHDataUpdate()};a.IsBlocked=function(){var b=a.Properties;if(b.HasPresenceInfo())return b.Presence.IsInBuddyListType(__IdCtrlNs.Presence.BuddyListType.BlockList);return false};a._SendIM=function(){a.SendIM()};a.SendIM=function(b){if(__IdCtrlNs.MsgrClient.IsEnabled(true))if(b)__IdCtrlNs.MsgrClient.SendIm(a,b);else __IdCtrlNs.MsgrClient.SendImNoMessage(a)};a.SetContactInfo=function(b,c){if(b!=null)a.SetProperties(b.ABCH,b.Presence);if(c!=null)a.CapabilityStatus=c};a.SetProperties=function(f,g,b){var e=__IdCtrlNs.IdentUpdateType.None,c=a.Properties;if(f!=null){if(a.IsMeContact()){c.ABCH=f;c.ABCH.CI.CT=ICSrv.CntType.Me}else c.ABCH=f;e|=__IdCtrlNs.IdentUpdateType.ABCH}if(g){c.Other=g;e|=__IdCtrlNs.IdentUpdateType.Other}if(b!=null){var d=c.Presence;if(null==d||d.Buddy.OnlineState!=b.Buddy.OnlineState||d.Buddy.BuddyListType!=b.Buddy.BuddyListType||d.Buddy.FriendlyName!=b.Buddy.FriendlyName||d.Buddy.PassportMemberName!=b.Buddy.PassportMemberName){c.Presence=b;e|=__IdCtrlNs.IdentUpdateType.Presence}}if(e!=__IdCtrlNs.IdentUpdateType.None)a.OnContactUpdate.fire(new __IdCtrlNs.EventData(a,e))};a.HasProperties=function(d,e,f){var b=true,c=a.Properties;if(d)b=b?c.HasABCHContactInfo():false;if(e)b=b?c.HasABCHDynamicInfo():false;if(f)b=b?c.HasPresenceInfo():false;return b};a.HasAnyProperties=function(){var b=a.Properties;return b&&(b.HasABCHContactInfo()||b.HasABCHDynamicInfo()||b.HasPresenceInfo())};a.Update=function(){if(b.mgr==null)b.mgr=__IdCtrlNs.DataMgrFactory.getInstance();var c=b.mgr.PresenceMgr;if(c&&c.IsInitialized()){var d=a.Properties;if(d.IsMessengerUser()||a.IsMeContact()){var e=c.GetPresencePropertiesForContact(a);if(__IdCtrlNs.MsgrClient.IsEnabled(true)){a.SetProperties(null,null,e);var f=a.IsMeContact()?__IdCtrlNs.MsgrClient.GetCurrentSignedInUserStatus():__IdCtrlNs.MsgrClient.GetUserStatus(a);if(f!=d.Presence.Buddy.OnlineState){d.Presence.Buddy.OnlineState=f;a.OnContactUpdate.fire(new __IdCtrlNs.EventData(a,__IdCtrlNs.IdentUpdateType.Presence))}}else a.SetProperties(null,null,e)}}else if(a.HasProperties(false,false,true)){a.Properties.Presence=null;a.OnContactUpdate.fire(new __IdCtrlNs.EventData(a,__IdCtrlNs.IdentUpdateType.Presence))}};var n=function(m){var i=CardSvc,l=__IdCtrlNs.Utility.DateIsEarlier,j=c();if(!j)return null;var d,f=new i.Request2;f.IdType=i.IdType.Contact;f.Id=a.ContactId.GetId();f.Partner=j.Partner;f.Market=j.Market;f.OpenLinksInNewWindow=m;if(a.HasProperties(false,true,false)){var b=a.Properties.ABCH.DI;f.Timestamps=d=new i.Stamps;d.UpdateTimestamps=a.IsGleaming();d.SLV=b.SLV;d.SLC=b.SLC;d.PLV=b.PLV;d.PLC=b.PLC;d.CPLC=b.CPLC;d.CPLV=b.CPLV;d.LCPLC=b.LCPLC;d.GM=b.GleamMask?b.GleamMask:0;var h=b.CPLC;if(l(h,b.SLC))h=b.SLC;if(l(h,b.PLC))h=b.PLC;d.elc=h;if(b.FS){d.Notifs=[];var n=b.FS.length;for(var k=0;k<n;++k){var g=b.FS[k],e=new i.Notif;e.ServiceType=g.ST;e.ForeignId=g.FId;e.RssUrl=g.Rss;e.LV=g.LV;e.LC=g.LC;e.Gleam=g.G;d.Notifs.push(e)}}}return f};a.requestCardBody=function(g,h,e){var a=false;if(b.cardInfo)if(b.cardInfo.timestamp==null||new Date-b.cardInfo.timestamp>15*60*1000){b.cardInfo.timestamp=null;a=true;b.cardRequestIssued=false}else return d();else a=true;if(a){var c={cb:g,context:h};if(b.cardRequestIssued){if(b.cardRequestQueue==null)b.cardRequestQueue=[];b.cardRequestQueue.push(c)}else f(false,c,e);return null}};var f=function(h,a,d){if(h){var c;b.cardRequestTimer=null;var g=__IdCtrlNs.DataMgrFactory.getInstance().getCardFppService();if(g){var f=n(d);if(f)g.getcard2(f,1,m,a,e);else c=true}else c=true;if(c)e({},a)}else{b.cardRequestIssued=true;b.cardRequestTimer=window.setTimeout(l(a,d),10)}},l=function(a,b){var c=function(){f(true,a,b);a=null};return c};a._setDisplayName=function(a){if(b.profileName==null)b.profileName=a};a.getDisplayName=function(){return b.profileName?b.profileName:null};var d=function(){return {id:a.ContactId,body:b.cardInfo.body,body2:b.cardInfo.body2,head:b.cardInfo.head,head2:b.cardInfo.head2,style:b.cardInfo.style,style2:b.cardInfo.style2}},m=function(e,c){if(e){if(b.cardInfo==null)b.cardInfo={};b.cardInfo.head2=e.HeadHtml2;b.cardInfo.body2=e.BodyHtml2;b.cardInfo.style2=e.Style2;b.cardInfo.timestamp=new Date;a.ClearGleam();if(c&&c.cb){var g=d();c.cb(g,c.context);if(b.cardRequestQueue){var f;while(b.cardRequestQueue.length>0){f=b.cardRequestQueue.pop();f.cb(g,f.context)}}}}},e=function(c,b){if(b&&b.cb)b.cb({id:a.ContactId,body:null,head:null,style:null},b.context)},c=function(){if(b.config==null)b.config=__IdCtrlNs.DataMgrFactory.getInstance().getConfigs();return b.config},o=function(){var b="",c=a.ContactId,d=c.GetIdType();if(d==__IdCtrlNs.IdType.Contact)b="cid="+c.GetId();return b},k=function(){},g=function(){a.OnABCHDataUpdate.fire(a)};a.Properties.OnABCHDataUpdate.attach(g);a.OnContactUpdate=new $Event;a.OnContactInitialized=new $Event;a.OnError=new $Event;a.OnABCHDataUpdate=new $Event;a.Update()};__IdCtrlNs.IdentityMgr=function(u,t){var k=u,a=this,b=[],c=t.Config;a.UrlUid={};a.ContactList=[];a.ContactListByCid={};a.ABContactsByCid={};a.AB=null;a.AddressBookStatus=__IdCtrlNs.ItemStatus.None;a.GetMeContact=function(){if(c&&b.meContact==null){var d=a.GetContact(c.ViewerId,true);if(d&&d.HasProperties(true,false,false)&&d.Properties.ABCH.CI&&d.Properties.ABCH.CI.CT==ICSrv.CntType.Me)b.meContact=d}return b.meContact};a.dispose=function(g){if(b.CreateFasterABLookupTimer){window.clearTimeout(b.CreateFasterABLookupTimer);b.CreateFasterABLookupTimer=null}if(b.ApplyABTimer){window.clearTimeout(b.ApplyABTimer);b.ApplyABTimer=null}var d=a.ABContactsByCid,e=d.length;for(var c=0;c<e;c++){d[c].OnABCHDataUpdate.detach(f);d[c].dispose(g)}b=a.ContactList=a.ContactListByCid=a.ABContactsByCid=a.AB=null;a.OnContactAdd.dispose();a.OnLoadContactsComplete.dispose();a.OnError.dispose();a.OnAddressBookLoadComplete.dispose();a=null};a.LoadContacts=function(b,a,c){g(b,a,c)};a.GetContact=function(b,d){var c;if(b&&b.GetIdType()==__IdCtrlNs.IdType.Contact&&b.GetId())c=a.ContactListByCid[b.GetId()];if(null!=c)return c;if(!d)return null;return q(b)};a.IsFriendOrFan=function(a){return b&&b.friends&&b.friends[a]==1};a.MarkAsFriendOrFan=function(c){if(!b.friends)b.friends={};b.friends[c]=1;a.NotifyExternalABChange()};var p=function(c){if(b.friends){var a,d=b.friends;for(a in d)if(d[a]==1)c[a]=1}b.friends=c},q=function(c){var b=new __IdCtrlNs.Contact(c,k);b.SetProperties(h(b));a.ContactList.push(b);if(c&&c.IsValidContact())a.ContactListByCid[c.GetId()]=b;return b};a.SendServerRequests=function(){if(a.AddressBookStatus==__IdCtrlNs.ItemStatus.None&&c&&c.ViewerId){var b=c.ViewerId.GetId();if(b!=0){a.AddressBookStatus=__IdCtrlNs.ItemStatus.Pending;k.IdentSvc.getaddressbookandsettings(c.Market,b,{},j(),r,null,null,15000)}}};var g=function(c,b,a){s(a,false)},h=function(d){var a=null,c=null,b=null;a=m(d.ContactId);if(a!=null&&(a.IsMsgr||a.CT==ICSrv.CntType.L||a.CT==ICSrv.CntType.Me))c=n(d.ContactId);if(a!=null)b=new __IdCtrlNs.ABCHProperties(a,c);return b},s=function(b,c){if(b!=null){a.AB=b;a.AB.ABContactsByCid={};p(a.AB.Friends);e(0);a.AddressBookStatus=__IdCtrlNs.ItemStatus.Retrieved}else if(c)a.AddressBookStatus=__IdCtrlNs.ItemStatus.Retrieved},l=function(a){var b=function(){e(a)};return b},e=function(d){b.CreateFasterABLookupTimer=null;var h=a.AB;if(h==null||h.Cs==null)return;var j=h.Cs,k=j.length,c,f=a.ABContactsByCid,d=d==null||d<1?0:d,m=new Date;for(var e=d;e<k;e++){if(new Date-m>50){b.CreateFasterABLookupTimer=window.setTimeout(l(e),250);return}c=j[e];if(c&&c.Cid){var g=c.Cid;if(f[g]==null||f[g].CT!=ICSrv.CntType.Me&&c.CT==ICSrv.CntType.Me)f[g]=c}}i(0)},o=function(a){var b=function(){i(a)};return b},i=function(d){b.ApplyABTimer=null;if(a.ABContactsByCid==null||a.AB==null)return;var d=d==null||d<1?0:d,k=new Date,c,g,i=a.ContactList,j=i.length;for(var e=d;e<j;e++){if(new Date-k>50){b.ApplyABTimer=window.setTimeout(o(e),200);return}c=i[e];if(c.Properties.ABCH==null&&!c.Properties.ABCHResolveAttempted){c.Properties.ABCHResolveAttempted=true;g=h(c);if(g!=null){c.SetProperties(g);c.OnABCHDataUpdate.attach(f)}}}a.OnAddressBookLoadComplete.fire(a)},r=function(a){if(a!=null){c.LoadFromServer(a.Set);g(null,false,a.AB)}},m=function(b){var c=a.AB;if(b==null||!b.IsValidContact()||c==null||c.Cs==null)return null;return a.ABContactsByCid[b.GetId()]},n=function(c){var e=a.AB;if(e==null||c==null||!c.IsValidContact()||e.PpDIs==null)return null;var d=e.PpDIs,f=d.length,g=c.GetId();for(var b=0;b<f;b++)if(d[b].Cid==g)return d[b];return null},f=function(){d()};a.NotifyExternalABChange=function(){d()};var j=function(c,e){var b=__IdCtrlNs.Utility.CookieGetValue("CCABUID");if(!b)if(e)b=1;else b=d(1);else b=parseInt(b);if(c)a.UrlUid.AbUidDataChanged=false;return b},d=function(d){var b;if(!a.UrlUid.AbUidDataChanged){if(d)b=d;else b=j(false,false);b+=1;var c=__IdCtrlNs.Utility;c.CookieWrite("CCABUID",b,c.GetTimeFromNow(15*60),c.GetSharedDomain(document.location.hostname),"/");a.UrlUid.AbUidDataChanged=true}return b};a.OnContactAdd=new $Event;a.OnLoadContactsComplete=new $Event;a.OnError=new $Event;a.OnAddressBookLoadComplete=new $Event};__IdCtrlNs.IdentityMgr.skipClass=true;__IdCtrlNs.MsgrClient=new function(){var a=this,b=__IdCtrlNs.Presence;a.SignedInUser=null;a.oMsgrClient=null;a.Version=null;a.Inited=false;a.m_mgr;a.m_configs;var i=function(a){return a.MsgrEnabled&&a.isSignedIn()&&$Browser.isIE()},g=function(){if(a.Inited)return;a.Inited=true;a.m_mgr=__IdCtrlNs.DataMgrFactory.getInstance();a.m_configs=a.m_mgr.getConfigs();if(!i(a.m_configs))a.oMsgrClient=null;else try{a.oMsgrClient=new ActiveXObject("MSNMessenger.Hotmail2Control");k()}catch(b){a.oMsgrClient=null}},k=function(){var b=1792;if(a.oMsgrClient){var c=a.oMsgrClient.GetLocalUserStatus();a.oMsgrClient.SetLocalUserStatus(c);b=2048}a.Version=b};a.IsSupported=function(){g();if(a.oMsgrClient==null)return false;return true};a.IsEnabled=function(c){g();var b=a.oMsgrClient!=null&&!a.m_disabled;if(b&&c){j();b=a.IsOnlineContact(a.SignedInUser)}return b};var j=function(){if(a.SignedInUser==null)a.SignedInUser="cid:"+a.m_configs.ViewerId.GetId()},d=function(b){var a=b.ContactId;if(a.GetIdType()==__IdCtrlNs.IdType.Contact)return "cid:"+a.GetId();return null};a.IsOnlineContact=function(b){if(!a.IsSupported("IsOnlineContact"))return false;return a.oMsgrClient.IsUser(b)};a.AddContact=function(b){if(!a.IsSupported("AddContact"))return;a.oMsgrClient.AddContact(a.SignedInUser,b)};a.DeleteContact=function(b){if(!a.IsSupported("DeleteContact"))return;a.oMsgrClient.DeleteContact(a.SignedInUser,b)};a.BlockContact=function(){a.ShowContactList()};a.UnblockContact=function(){a.ShowContactList()};a.ShowContactList=function(){if(!a.IsSupported("ShowContactList"))return;a.oMsgrClient.ShowContactList()};a.GetCurrentSignedInUserStatus=function(){if(!a.IsSupported("GetCurrentSignedInUserStatus"))return b.State.Offline;var c=a.InternalStatusToStatus(a.oMsgrClient.GetLocalUserStatus());if(c==b.State.Offline)a.SignedInUser=null;return c};a.SetCurrentSignedInUserStatus=function(b){if(!a.IsSupported("SetCurrentSignedInUserStatus"))return;return a.oMsgrClient.SetLocalUserStatus(h(b))};a.SetCurrentSignedInUserDisplayName=function(){if(!a.IsSupported("SetCurrentSignedInUserDisplayName"))return;a.ShowContactList()};a.GetUserStatus=function(f){if(!a.IsSupported("GetUserStatus"))return b.State.Offline;try{var e=d(f),c;if(e){c=a.oMsgrClient.GetUserStatus(e);return a.InternalStatusToStatus(c)}}catch(g){}return b.State.Offline};a.GetBuddy=function(c){var e=d(c)!=a.SignedInUser?a.GetUserStatus(c):a.GetCurrentSignedInUserStatus();return new b.Buddy(c,b.BuddyListType.AllowList,e)};var c=[{IntStatus:1,stat:b.State.Offline},{IntStatus:2,stat:b.State.Online},{IntStatus:6,stat:b.State.Invisible},{IntStatus:10,stat:b.State.Busy},{IntStatus:14,stat:b.State.BeRightBack},{IntStatus:18,stat:b.State.Idle},{IntStatus:34,stat:b.State.Away},{IntStatus:50,stat:b.State.OnThePhone},{IntStatus:66,stat:b.State.OutToLunch}],f={};for(var e=0;e<c.length;++e)f[c[e].IntStatus]=c[e].stat;a.InternalStatusToStatus=function(c){var a=f[c];return a==null?b.State.Offline:a};var h=function(b){for(var a=0;a<c.length;++a)if(c[a].stat==b)return c[a].IntStatus;return 1};a.IsStateOnline=function(c){if(!a.IsSupported("IsStateOnline"))return false;return c!=b.State.Offline};a.SendIm=function(c,e){var b=d(c);if(!a.IsSupported("SendIm"))a.SendImNoMessage(b);else try{a.oMsgrClient.InstantMessage2(b,e,0)}catch(f){return}};a.SendImNoMessage=function(b){var c=d(b);if(!a.IsSupported("SendImNoMessage"))return;try{a.oMsgrClient.InstantMessage2(c,"",0)}catch(e){return}}};__IdCtrlNs.Presence.Buddy=function(c,b,d){var a=this;a.Contact=c;a.BuddyListType=b;a.OnlineState=d};__IdCtrlNs.PresenceMgr=function(k){var o=k,a=this,b=__IdCtrlNs.Presence;a.ConnectionState=b.ConnectionState.SignedOut;a.MeStatusCode=0;a.ContactList=null;var d=[],c=__IdCtrlNs.MsgrClient.IsEnabled;a.dispose=function(){if(d.UpdateAlContactsTimer){window.clearTimeout(d.UpdateAlContactsTimer);d.UpdateAlContactsTimer=null}a.OnSignInComplete.dispose();a.OnSignOut.dispose();a.OnConversationClosed.dispose();a.OnConversationOpened.dispose();a.OnUnreadEmailUpdate.dispose();a.OnError.dispose();k=a=o=a.ContactList=d=null};a.SignIn=function(c){var d=c!=null?c:b.State.Online;a.UpdateServerPollStatus(10000)};a.SignOut=function(){e(b.ConnectionState.SignedOut);if(c(false))__IdCtrlNs.MsgrClient.SignOut()};a.IsInitialized=function(){return this.ConnectionState==b.ConnectionState.SignedIn};a.GetPresencePropertiesForContact=function(a){var c=c=n(a,true),d=a.Properties;if(c!=null)return new __IdCtrlNs.PresenceProperties(c);else if(d.HasPresenceInfo()&&d.Presence.Buddy.OnlineState!=b.State.Offline)return new __IdCtrlNs.PresenceProperties(new b.Buddy(a,b.BuddyListType.AllowList,b.State.Offline));return null};var n=function(b){if(c(true))return __IdCtrlNs.MsgrClient.GetBuddy(b);if(a.ContactList==null||b.ContactId==null)return null;return null},i=new Date;a.UpdateServerPollStatus=function(a){i.setTime((new Date).getTime()+a)};a.SendServerRequests=function(){if(new Date>=i)if(c(false))l()};var h=true,g=true,l=function(){if(a.ConnectionState!=b.ConnectionState.SignedIn)if(c(true)){e(b.ConnectionState.SignedIn);g=true;h=true}else switch(__IdCtrlNs.MsgrClient.GetCurrentSignedInUserStatus()){case b.State.Offline:if(g){e(b.ConnectionState.SignedOut);g=false}break;default:if(h){e(b.ConnectionState.SignedOut);h=false}}else{if(!c(true))a.ConnectionState=b.ConnectionState.SignedOut;if(!f)j(0)}a.UpdateServerPollStatus(3000)},m=function(a){var b=function(){j(a)};return b},f=false,j=function(a){d.UpdateAlContactsTimer=null;f=true;var c=__IdCtrlNs.DataMgrFactory.getInstance().IdentMgr.ContactList;if(c!=null){var a=a==null||a<1?0:a,g=new Date,e=c.length;for(var b=a;b<e;b++){if(new Date-g>200){d.UpdateAlContactsTimer=window.setTimeout(m(b),200);return}c[b].Update()}}f=false},e=function(d,c){a.ConnectionState=d!=null?d:a.ConnectionState;a.MeStatusCode=c!=null?c:a.MeStatusCode;var b=__IdCtrlNs.DataMgrFactory.getInstance().IdentMgr.GetMeContact();if(b)b.OnContactUpdate.fire(new __IdCtrlNs.EventData(b,__IdCtrlNs.IdentUpdateType.Presence))};a.GetAvailableStates=function(){var e=c(false),d=[];switch(a.ConnectionState){case b.ConnectionState.SigningOut:case b.ConnectionState.SignedOut:d.push(b.State.Online);if(!e){d.push(b.State.Busy);d.push(b.State.BeRightBack);d.push(b.State.Away);d.push(b.State.OnThePhone);d.push(b.State.OutToLunch);d.push(b.State.Invisible)}break;case b.ConnectionState.SigningIn:case b.ConnectionState.SignedIn:d.push(b.State.Online);d.push(b.State.Busy);d.push(b.State.BeRightBack);d.push(b.State.Away);d.push(b.State.OnThePhone);d.push(b.State.OutToLunch);d.push(b.State.Invisible);d.push(b.State.Offline)}return d};a.OnSignInComplete=new $Event;a.OnSignOut=new $Event;a.OnConversationClosed=new $Event;a.OnConversationOpened=new $Event;a.OnUnreadEmailUpdate=new $Event;a.OnError=new $Event};__IdCtrlNs.CtrlSize=new $Enum("Undefined","ThumbnailNoName","Thumbnail1Line","Thumbnail2Line","Thumbnail3Line","ThreeLineView","OneTextLine","TextOnly");__IdCtrlNs.IdentityUI=function(d,b){__IdCtrlNs.IdentityUI.initializeBase(this,arguments);var E=function(){var a={};this.queueEpLoad=function(e,b){var d=false;if(b)if(!a.loaded){a.configs=e;if(!a.cbQueue){a.cbQueue=[];d=true}a.cbQueue.queue(b);if(d)c()}else b()};function c(){var c=$Network,d=a.configs;(new c(Array.$Prioritizer.Low)).add(c.Type.Script,["{framework.base}CoreUI.js",d.UxpLiveControlsBinding+"js/Live.Controls.EnhancedPreview.js",d.UxpLiveStrings+"strings.js"]).add(c.Type.CSS,["{theme.url}controls.css"]).add(c.Type.Image,["{theme.url}controls/img/ep_beak_leftright_collage.gif","{theme.url}controls/img/ep_dots_collage.gif","{theme.url}controls/img/ep_loading_collage.gif","{theme.url}controls/img/ep_more_actions.gif","{theme.url}hig/img/glyph/close_rest_dark.gif"]).load(b)}function b(){var b,c=a.cbQueue;a.loaded=true;while(c.length>0){b=c.dequeue();b()}}},c=this;b=this.getParameters();var I,a={},e,h=__IdCtrlNs.IdentityUI.lookups;c.initialize=function(){H();__IdCtrlNs.IdentityUI.callBaseMethod(this,"initialize",arguments);a.timer=window.setTimeout(z,1)};c.dispose=function(){if(a.timer)window.clearTimeout(a.timer);if(a.tmrAttachEvtEP)window.clearTimeout(a.tmrAttachEvtEP);d.detachEvent("onclick",o);if(a.contact&&a.size!=__IdCtrlNs.CtrlSize.TextOnly)a.contact.OnContactUpdate.detach(j);__IdCtrlNs.IdentityUI.callBaseMethod(this,"dispose",arguments);if(e)e.dispose();n();c=a=e=d=b=null};var n=function(){if(a.ep&&a.ep.hide&&typeof a.ep.hide=="function"){try{a.ep.hide()}catch(b){}if(a.epAttachEl)$Binding.remove(a.epAttachEl);a.ep=null}},H=function(){e=new $Memory.Groups;e.icGroup=e.create(null);a.mgr=__IdCtrlNs.DataMgrFactory.getInstance();a.size=C(b.ids);a.id=G(b.idt,b.idv);a.epDelayMs=b.epd?b.epd:null;a.openDefaultActionsInNewWindow=b.odnw=="1"||b.odnw=="true";a.mgr.registerControl(a.id,c);a.tmrAttachEvtEP=window.setTimeout(s,100)},s=function(){a.tmrAttachEvtEP=null;d.onclick=null;d.attachEvent("onclick",o);g();if(a.id&&a.id.GetIdType()==__IdCtrlNs.IdType.Contact&&a.id.GetId()!="0"){var b=a.mgr.getConfigs();if(a.epAttachEl==null&&a.controlA)a.epAttachEl=a.controlA;if(a.epAttachEl&&!a.epDisabled){if(!__IdCtrlNs.IdentityUI.s_epHelper)__IdCtrlNs.IdentityUI.s_epHelper=new E;__IdCtrlNs.IdentityUI.s_epHelper.queueEpLoad(b,p)}}};function p(){var b={bodyTemplateType:"Live.Controls.BodyTemplate",headtemplatetype:"Live.Controls.HtmlHeadTemplate",attachtobody:$Browser.isIE()?"false":"true",actionlinksmaywrap:"false",displaytimeout:a.epDelayMs,minimumvisibleactioncount:5,maximumvisibleactioncountbeforehiding:6};$Binding.define("Live.Controls.EnhancedPreviewItem").setDefaults(b).bindTo(a.epAttachEl).attach(function(a){D(a&&a[0])})}var D=function(b){a.ep=b;if(a&&a.inClickHandler)a.ep.hide()},C=function(c){var b=h.parseSize;if(b==null){var a=__IdCtrlNs.CtrlSize;b=h.parseSize={otl:a.OneTextLine,to:a.TextOnly,tlv:a.ThreeLineView,txs:a.Thumbnail1Line,ts:a.Thumbnail1Line,tm:a.Thumbnail1Line,tl:a.Thumbnail1Line,txl:a.Thumbnail1Line}}var d=b[c];return d},G=function(d,c){var b=h.parseId;if(b==null){var a=__IdCtrlNs.IdType;b=h.parseId={c:a.Contact,e:a.Event,g:a.Group,p:a.PartnerDefined}}var e=b[d];return new __IdCtrlNs.IdentityId(e,c)},u=function(){if(a.customIconData==null){var e={},c;for(var d=1;d<=2;++d)if(b["ci"+d+"j"]){c=new __IdCtrlNs.Icon(b,d);if(c)e[c.IconNum]=c}a.customIconData=e}},r=function(){if(a.customActions==null){var e=[],c=1,d;for(var c=1;c<=2;++c)if(b["ca"+c+"t"]){d=new __IdCtrlNs.Action(b,c);if(d)e.push(d)}a.customActions=e}},g=function(){if(!a.foundEls){a.foundEls=true;var c=__IdCtrlNs.CtrlSize,b=a.size;if(b==c.Thumbnail1Line)v();else if(b==c.ThreeLineView)y();else if(b==c.OneTextLine)x();else if(b==c.TextOnly)w()}},i=function(){var c;c=d.getElementsByTagName("td");if(c&&c.length>=2){a.ciElem=c[1];a.ciAnchors=c[1].getElementsByTagName("a")}c=d.getElementsByTagName("div");if(c&&c.length>0){var i=0,h;for(var e=0;e<c.length&&i<=2;++e)if(c[e].className=="txt"){h=c[e].innerText;switch(i){case 0:a.profileName=h;f();break;case 1:a.customText1=h;break;case 2:a.customText2=h}++i}}if(!a.profileName)if(b.nm){a.profileName=__IdCtrlNs.Utility.decodeHtmlMarkup(b.nm);f()}var g;c=d.getElementsByTagName("img");if(c&&c.length>0)for(var e=0;e<c.length;++e)if(c[e].className=="IcPh"){g=a.photo=c[e];if(g.parentNode&&g.parentNode.tagName&&g.parentNode.tagName.toLowerCase()=="a")a.controlA=g.parentNode;break}},v=function(){i()},y=function(){i()},x=function(){var e,b,c;b=d.getElementsByTagName("div");if(b&&b.length>=1){b=b[0].getElementsByTagName("div");if(b&&b.length>=2){a.ciElem=b[0];a.ciAnchors=b[0].getElementsByTagName("a");c=b[1].getElementsByTagName("a");if(c==null||c.length==0)a.profileName=b[1].innerText;else{a.epAttachEl=a.controlA=c[0];a.profileName=c[0].innerText}f()}}},w=function(){var b=d.getElementsByTagName("a");if(b&&b.length>=1){a.controlA=a.epAttachEl=b[0];a.profileName=b[0].innerText;f()}},z=function(){a.timer=null;var b=a.contact=a.mgr.IdentMgr.GetContact(a.id,true);f();if(b&&a.size!=__IdCtrlNs.CtrlSize.TextOnly){b.OnContactUpdate.attach(j);if(b.HasAnyProperties(false,true,true))F()}},f=function(){if(a&&a.contact&&a.profileName)a.contact._setDisplayName(a.profileName)},F=function(){if(!a.gleamStateResolved){l();a.gleamStateResolved=true}if(!a.presenceStateResolved){m();a.presenceStateResolved=true}},j=function(a){var b=__IdCtrlNs.IdentUpdateType,c=false;if(a&&a.Data){if((a.Data&b.ABCH)>0)l();if((a.Data&b.Presence)>0)m()}},l=function(){g();var b=a.contact.IsGleaming();if(a.ciGleam==null&&b){var d=CNP_GLEAM_ICON_TOOLTIP,c=e.icGroup.Nodes;a.ciGleam=c.create("a",{href:"#",title:d},{});e.icGroup.Events.register(a.ciGleam,{"onclick":k});c.create("img",{className:"ci",src:__IdCtrlNs.Utility.GetWLThemeImageUrl(a.mgr.getConfigs(),"Gleam.gif"),alt:d},{},a.ciGleam);B(a.ciElem,a.ciGleam)}else if(a.ciGleam!=null&&!b){a.ciElem.removeChild(a.ciGleam);a.ciGleam.detachEvent("onclick",k);a.ciGleam=null}},m=function(){g();var b=__IdCtrlNs.Utility.GetPresenceImgInfo(a.contact);if(!b)return;if(b&&a.ciPres==null){var c=e.icGroup.Nodes;a.ciPres=c.create("a",{href:"#",title:b.action},{});e.icGroup.Events.register(a.ciPres,{"onclick":t});a.ciPresImg=c.create("img",{className:"ci",src:b.image,alt:b.action},{},a.ciPres);A(a.ciElem,a.ciPres)}else if(b){a.ciPresImg.src=b.image;a.ciPresImg.alt=b.action}else{a.ciElem.removeChild(a.ciPres);a.ciPres=a.ciPresImg=null}},A=function(a,c){var b=a.childNodes;if(b==null||b.length==0)a.appendChild(c);else a.insertBefore(c,b.item(0))},B=function(a,c){var b=a.childNodes;if(b==null||b.length<=1)a.appendChild(c);else a.insertBefore(c,b.item(1))},o=function(e){if(!a.inClickHandler&&(e==null||e.returnValue||typeof e.returnValue=="undefined")){var f=false,k=false,b=e.srcElement;while(b){if(a.controlA&&a.controlA==b){k=true;break}else if(b.className){if(b.className.indexOf("identctrl")>=0)break;if(b.className.indexOf("uxp_ep")>=0){f=true;return}}b=b.parentNode}if(a.ep)a.ep.hide();a.inClickHandler=true;g();u();var m=window.event,c=m.srcElement;if(!k){if(c&&a.customIconData){var h=c.getAttribute("ic:id"),i=0;if(c.childNodes)while(!h&&i<c.childNodes.length){if(c.childNodes[i].tagName=="IMG")h=c.childNodes[i].getAttribute("ic:id");i++}if(h){var l=a.customIconData[h];if(l){f=true;l.fire(a.contact,d)}}}}else{var j=q();if(j&&!j.isUrlAction()){f=true;j.fire(a.contact,d)}}if(f)__IdCtrlNs.Utility.CancelBubble(e);if(a)a.inClickHandler=false}},k=function(b){__IdCtrlNs.Utility.CancelBubble(b);if(a&&a.ep)a.ep.show()},t=function(b){__IdCtrlNs.Utility.CancelBubble(b);if(a&&a.contact)a.contact.SendIM()};c.getIdentity=function(){return a?a.contact:null};c.getIdentityId=function(){return a?a.id:null};c.getCustomActions=function(){r();return a.customActions};c.getCustomText=function(){var c=null,d=null;if(a){if(a.customText1)c=a.customText1;else if(b.ct1)c=a.customText1=b.ct1;if(a.customText2)d=a.customText2;else if(b.ct2)d=a.customText2=b.ct2}return [c,d]};var q=function(){var a=c.getCustomActions();if(a){var d=a.length;for(var b=0;b<d;++b)if(a[b]&&a[b].isDefaultAction())return a[b]}return null};c.getOpenDefaultActionsInNewWindow=function(){return a.openDefaultActionsInNewWindow};c._disableEP=function(){a.epDisabled=true;n()};c._disableEPItems=function(b){a.epHiddenMenuItemFlags=b};c._getDisabledEPItems=function(){return a&&a.epHiddenMenuItemFlags?a.epHiddenMenuItemFlags:0};c._getControlSize=function(){return a.size}};__IdCtrlNs.IdentityUI.registerClass("Live.Spaces.IdentityControl.IdentityUI","$Binding");__IdCtrlNs.IdentityUI.Params=new $Enum("idt","idv","ids","odnw","nm","ct1","ct2","ci1j","ci1d","ci2j","ci2d","ca1t","ca1u","ca1un","ca1da","ca1j","ca1d","ca2t","ca2u","ca2un","ca2da","ca2j","ca2d","epd");__IdCtrlNs.IdentityUI.skipClass=true;__IdCtrlNs.IdentityUI.lookups={};__IdCtrlNs.DataMgrFactory=new function(){var a=this;a.getInstance=function(){var a=__IdCtrlNs.__DataManagerInstance;if(!a){a=new __IdCtrlNs.DataMgr(document.body,{gblObject:__IdCtrlNs,gblPropName:"__DataManagerInstance"});a.initialize()}return a}};__IdCtrlNs.DataMgr=function(l,c){__IdCtrlNs.DataMgr.initializeBase(this,arguments);var a=this;if(c.gblObject&&c.gblPropName)c.gblObject[c.gblPropName]=a;c=this.getParameters();var j,b={};b.controls={};b.controls.ByIdentId={};b.controls.ByElmId={};var e;a.IdentSvc;a.IdentMgr;a.PresenceMgr;var d;a.initialize=function(){k();__IdCtrlNs.DataMgr.callBaseMethod(this,"initialize",arguments)};a.dispose=function(e){__IdCtrlNs.DataMgr.callBaseMethod(this,"dispose",arguments);if(d){window.clearTimeout(d);d=null}if(a.IdentMgr){a.IdentMgr.OnAddressBookLoadComplete.detach(g);a.IdentMgr.dispose(e)}if(a.PresenceMgr)a.PresenceMgr.dispose(e);a=a.IdentSvc=a.PresenceMgr=b=l=c=null};var k=function(){if(!j){j=true;var c=b.config=__IdCtrlNs.Configs;c.Load();var e=new ICSrv.FppProxySettings;e.CanaryToken=c.CanaryCookieName;e.Version=ICSrv.FppVersion.TWO;e.PartnerId=c.Partner;e.SessionId=c.ViewerId.GetId();e.DefaultRetry=1;if(c.ProxyFppUrl)e.ServerTunnelingUrl=c.ProxyFppUrl;else e.UseClientXmlProxy=true;var f=h(c.IdentSvcHost,c);f="http://"+f+"/ContactControl/IdentityService.fpp";a.IdentSvc=ICSrv.initializeEx(f,e);a.IdentMgr=new __IdCtrlNs.IdentityMgr(a,{Config:c});a.IdentMgr.OnAddressBookLoadComplete.attach(g);d=window.setTimeout(i,0)}},h=function(a,c){a=$Request.extractHost(a,false);if(!f(a,c)){var b=c.ViewerId.GetId();if(b!=0)a="cid-"+__IdCtrlNs.Utility.FormatCidAsHex(b)+"."+a}return a},f=function(a){a=$Request.extractHost(a,false);var b={"cc.services.spaces.live.com":1,"cc.services.spaces-f1.live-int.com":1,"cc.services.spaces-current.live-int.com":1,"cc.services.spaces-f3.live-int.com":1,"cc.services.spaces.live-int.com":1,"cc.services.spaces-dvl.live-int.com":1,"cc.services.spaces-bvt.live-int.com":1};return a.endsWith(":94")||b[a.toLowerCase()]!=1};a.getRollingUpgrade=function(){return f(b.config.IdentSvcHost,b.config)};a.getConfigs=function(){k();return b?b.config:null};a.getCardFppService=function(){if(e==null&&b){var c=b&&b.config?b.config:null;if(c){var a=new CardSvc.FppProxySettings;a.CanaryToken=c.CanaryCookieName;a.Version=CardSvc.FppVersion.TWO;a.PartnerId=c.Partner;a.SessionId=c.ViewerId.GetId();a.DefaultRetry=1;a.AllowDuplicate=true;if(c.ProxyFppUrl)a.ServerTunnelingUrl=c.ProxyFppUrl;else a.UseClientXmlProxy=true;var d=h(c.IdentSvcHost,c);d="http://"+d+"/ContactCard/ContactCard.fpp";e=CardSvc.initializeEx(d,a)}}return e};var i=function(){var c=a.IdentMgr;if(c!=null)c.SendServerRequests();if(a.PresenceMgr!=null)a.PresenceMgr.SendServerRequests();else if(b.ABLoaded){a.PresenceMgr=new __IdCtrlNs.PresenceMgr(this);a.PresenceMgr.SignIn()}d=window.setTimeout(i,1000)};a.registerControl=function(d,a){if(d&&a){b.controls.ByIdentId[d.toString()]=a;var c=a._element;if(c&&c.id)b.controls.ByElmId[c.id]=a}};a.getControlByElementId=function(a){return a?b.controls.ByElmId[a]:null};var g=function(){b.ABLoaded=true}};__IdCtrlNs.DataMgr.skipClass=true;__IdCtrlNs.DataMgr.registerClass("Live.Spaces.IdentityControl.DataMgr","$Binding");__IdCtrlNs.Icon=function(c,d){var b=this,a={};b.IconNum=d;var e=function(){var b="ci"+d;a.jsFncName=c[b+"j"];a.jsFncData=c[b+"d"]};e();b.dispose=function(){b=b.IconNum=c=a=null};b.fire=function(c,b){if(a.fcnObj==null)if(a.jsFncName)a.fcnObj=Function.parse(a.jsFncName);if(a.fcnObj)a.fcnObj(c,b,a.jsFncData)}};__IdCtrlNs.Action=function(c,d){var b=this,a={};b.ActionNum=d;var e=function(){var b="ca"+d;a.txt=c[b+"t"];a.url=c[b+"u"];a.useNewWin=c[b+"un"]=="1"?true:false;a.isDefault=c[b+"da"]?true:false;a.jsFncName=c[b+"j"];a.jsFncData=c[b+"d"]};e();b.dispose=function(){b=b.ActionNum=c=a=null};b.getText=function(){return a.txt};b.getUrl=function(){return a.url};b.getUseNewWindow=function(){return a.useNewWin};b.isDefaultAction=function(){return a.isDefault};b.getJSCallback=function(){return a.jsFncName};b.getJSCallbackData=function(){return a.jsFncData};b.isUrlAction=function(){return a.url?true:false};b.fire=function(c,b){if(a.fcnObj==null)if(a.jsFncName)a.fcnObj=Function.parse(a.jsFncName);if(a.fcnObj)a.fcnObj(c,b,a.jsFncData)}};__IdCtrlNs.TrackManager=function(c,e,d){var f=this,a={NameSpacePrefix:c,Market:e,LinkId:d};f.track=function(a){g(a)};function g(a){var d=b().format(a.ContentModule,a.ContentElement,a.HeadLine),c=new Image;c.src=d}function b(){if(!a.resolvedUrlFormat){var b=a.Market.toLowerCase().replace("-","_");a.resolvedUrlFormat="http://g.live.com/"+a.NameSpacePrefix+b+"/"+a.LinkId+"?cm={0}&ce={1}&hl={2}"}return a.resolvedUrlFormat}};__IdCtrlNs.TrackItem=function(c,b,d){var a=this;a.ContentModule=c;a.ContentElement=b;a.HeadLine=d};__IdCtrlNs.HideMenuItems=new $Flags("ViewFriends",1);__IdCtrlNs.EPDataProvider=function(){__IdCtrlNs.EPDataProvider.initializeBase(this,arguments);var z=this,a={};this.initialize=function(){__IdCtrlNs.EPDataProvider.callBaseMethod(this,"initialize",arguments);a.identMgr=__IdCtrlNs.DataMgrFactory.getInstance();a.configs=a.identMgr.getConfigs();this.registerFor("Live.Controls.EnhancedPreviewController",u)};this.dispose=function(){__IdCtrlNs.EPDataProvider.callBaseMethod(this,"dispose",arguments);z=a=null};function u(a,b){if(b)a.attachEvent("onbeforeopen",i);else a.detachEvent("onbeforeopen",i)}function i(i){var f=i.Package,d=f.template,c=f.srcElement,b;y();v();var h=0;while(c&&++h<7){if(c.className&&c.className.indexOf("identctrl")>=0){b=c.id;break}c=c.parentNode}if(!b)return;if(!(b.startsWith("ICc")||b.startsWith("ICe")||b.startsWith("ICp")))return;var e=a.identMgr.getControlByElementId(b);if(e){a.currentUI=e;a.currentIdentity=e.getIdentity();d.actions.clear();q(e,d.actions)}var g=d.head,j=d.body;g.title=g.subtitle=g.html=j.body="";a.invalidateActions=true;o(f)}var q=function(i,b){var e=a.currentIdentity;if(e==null||i==null)return;var f=a.configs.isSignedIn(),q,h,g;m();var o=__IdCtrlNs.HideMenuItems,p=i._getDisabledEPItems(),c=i.getCustomActions();h=c&&c.length>0;if(h){g=c[0].isDefaultAction();if(g)j(c,b)}var k=window.location,l=k&&k.pathname&&k.pathname.toLowerCase().startsWith("/networkexplorer.aspx");if(!l)d(a.contactActions.ViewSpace,b);if(h&&!g)j(c,b);if(!f||!e.IsInMySocialNetwork())d(a.contactActions.AddFriend,b);if(l)d(a.contactActions.ViewSpace,b);if((p&o.ViewFriends)==0)d(a.contactActions.ViewFriends,b);d(a.contactActions.ViewRecentActivity,b);if(!f||!e.IsInMyLiveContact())d(a.contactActions.SetAsLiveContact,b);var n=e.IsInMyBuddyList();if(f&&!n)d(a.contactActions.AddToBuddyList,b);if(f&&n&&e.HasProperties(false,false,true))d(a.contactActions.SendIM,b)},j=function(b,d){var c=Math.min(2,b.length);for(var a=0;a<c;++a)if(b[a])t(b[a],d)},t=function(a,b){if(a)b.add(a.getText(),"#",function(){p(a)})},p=function(b){r(b);if(b.isUrlAction())__IdCtrlNs.Utility.OpenLink(b.getUrl(),b.getUseNewWindow(),true);else if(a&&a.currentIdentity&&a.currentUI)b.fire(a.currentIdentity,a.currentUI);__IdCtrlNs.Utility.CancelBubble()},r=function(d){var b;if(d.ActionNum==1){if(!a.customActionTrack1)a.customActionTrack1=c("Custom action 1 (partner)","Cstm1");b=a.customActionTrack1}else{if(!a.customActionTrack2)a.customActionTrack2=c("Custom action 2 (partner)","Cstm2");b=a.customActionTrack2}k().track(b)},d=function(a,b){b.add(a.getText(),"#",a.getJSCallback())},m=function(){if(a.contactActions==null){var h={},d,b,g=a.contactAPIs;if(g==null)g=a.contactAPIs={};b=CNP_VIEW_SPACE;d=h.ViewSpace=new __IdCtrlNs.Action({cat:b,cada:1,caj:e},"");f(g,d,b,"ViewSpace",c("View Space","vwSpc"));b=CNP_VIEW_PROFILE;d=h.ViewRecentActivity=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"ViewRecentActivity",c("View recent activity","vwRAct"));b=CNP_VIEW_SOCIAL_NETWORK;d=h.ViewFriends=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"ViewSocialNetwork",c("View friends","vwFrnds"));b=CNP_INVITE_TO_MYBUDDYLIST;d=h.AddToBuddyList=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"AddToBuddyList",c("Invite to be a Messenger contact","invToMsngr"));b=CNP_ADD_TO_MYSOCIALNETWORK;d=h.AddFriend=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"AddFriend",c("Invite to be a friend","invFrnds"));b=CNP_SET_LIVECONTACT;d=h.SetAsLiveContact=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"SetAsLiveContact",c("Receive contact updates","getCntctUpdt"));b=CNP_SEND_IM;d=h.SendIM=new __IdCtrlNs.Action({cat:b,caj:e},"");f(g,d,b,"_SendIM",c("Send instant message","sndIMsg"));a.contactActions=h}},f=function(b,c,a,d,e){var f={id:a,action:c,api:d,trk:e};b[a]=f};function c(b,c){return new __IdCtrlNs.TrackItem(b,a.configs.Partner,c)}function k(){if(!a.trackMgr)a.trackMgr=new __IdCtrlNs.TrackManager("_0sa",a.configs.Market,"1000");return a.trackMgr}var e=function(b){__IdCtrlNs.Utility.CancelBubble();var f=a.currentIdentity,e;if(b&&b.srcElement&&b.srcElement.innerText)e=b.srcElement.innerText;var g=a.contactAPIs,c=g[e];if(c){k().track(c.trk);var d=f[c.api];if(d)d(!a.currentUI.getOpenDefaultActionsInNewWindow())}},o=function(b){var d=b.template.body;d.identityCardLoaded=false;var c,e={Package:b,RequestId:n()};if(a&&a.currentIdentity)c=a.currentIdentity.requestCardBody(h,e,a.currentUI.getOpenDefaultActionsInNewWindow());if(c)h(c,e);else{var f=b.template.head;f.title=f.html="";if(!d.identityCardLoaded)d.body='<div class="uxp_ep_loadingTemplate" onclick="window.event.returnValue=false;window.event.cancelBubble=true;"><span class="uxp_ep_loadingImageCollage">&nbsp;</span><div class="uxp_ep_loadingText">'+Live.Controls.Strings.LiveEnhancedPreviewStrings.Loading+"</div></div>";g(b.srcObject,["head","body"])}},h=function(a,c){var b=c.Package;if(a&&a.head2&&a.body2){if(!s(c.RequestId))return;var d=b.template.body;d.identityCardLoaded=true;b.template.head.html=w(a.head2);d.body=a.body2;g(b.srcObject,["head","body"]);x(a)}else{b.template.body.body='<div class="uxp_ep_loadErrorTemplate"><span class="uxp_ep_loadingImageCollage">&nbsp;</span><div class="uxp_ep_loadingText">'+Live.Controls.Strings.LiveEnhancedPreviewStrings.LoadError+"</div></div>";g(b.srcObject,["body"])}},w=function(b){var g="<!--icnonameS-->",h="<!--icnonameE-->",d=b.indexOf(g);if(d>0){var f=b.indexOf(h,d+g.length);if(f>0){var j=b.substring(d,f+h.length),i=a&&a.currentIdentity?a.currentIdentity.getDisplayName():null;if(i)b=b.replace(j,i.encodeHtml())}}var e=__IdCtrlNs.Utility.GetPresenceImgInfo(a.currentIdentity);if(e){var k='<img class="ci" alt="'+e.text.encodeHtml()+'" src="'+e.image.encodeHtmlAttribute()+'" />';b=b.replace("<!--icCI1-->",k)}var c=a.currentUI.getCustomText();if(c&&c.length>=2){if(c[0])b=b.replace("<!--icCL1-->",c[0].encodeHtml());if(c[1])b=b.replace("<!--icCL2-->",c[1].encodeHtml())}return b},x=function(i){if(i&&i.style2){var d=$Browser.isIE(),c=i.style2,e=d?{}:new $StringBuilder,j="color:",g=(d?(a&&a.currentUI&&a.currentUI._getControlSize()==__IdCtrlNs.CtrlSize.TextOnly?"span":"div")+".identctrl ":"")+"div.uxp_ep_ep ",f;f=g+"div.uxp_ep_head ";if(c.HeadText)b(e,d,c.HeadText,f+".IcTxt");var h="";if("rtl"==document.body.currentStyle.direction)h=";direction:rtl";if(c.HeadBkgd)b(e,d,c.HeadBkgd+h,f);else b(e,d,h,f);f=g+"div.uxp_ep_body ";if(c.BodyTitle)b(e,d,c.BodyTitle,f+".IcTtl");if(c.BodyPartTitle)b(e,d,c.BodyPartTitle,f+".IcBpt");if(c.BodyText)b(e,d,c.BodyText,f+".IcBt");tmp="";if(c.BodyBkgd)tmp+=c.BodyBkgd;if(c.DivClr)tmp+=c.DivClr;if(tmp.length>0)b(e,d,tmp,f);f=g+"div.uxp_ep_actions ";if(c.ActBkgd)b(e,d,c.ActBkgd,f);if(c.ActText)b(e,d,c.ActText,f+"li a");if(!d){b(e,d,"padding:4px;","div.uxp_ep_ep a.uxp_ep_close");b(e,d,"width:20em;","div.uxp_ep_ep");b(e,d,"display:none;","div.uxp_ep_ep div.uxp_ep_sectionSeparator")}l(e)}},l=function(d){var b=a.elStyle;if(b==null)b=a.elStyle=document.getElementById("icStyle2");if(b)if(b.styleSheet){var f=b.parentNode;f.removeChild(b);var c=b.styleSheet;if(c.rules)while(c.rules.length>0)c.removeRule();for(var e in d)c.addRule(e,d[e]);f.appendChild(b)}else b.innerHTML=d.toString()},y=function(){l($Browser.isIE()?{}:"")},b=function(a,d,c,b){if(d)a[b]=c;else{a.append(b);a.append("{");a.append(c);a.append("} ")}};function v(){a.currentRequestId=++__IdCtrlNs.EPDataProvider.requestId;return a.currentRequestId}function s(b){return a.currentRequestId==b}function n(){return a.currentRequestId}var g=function(c,b){try{if(a.invalidateActions){b.push("actions");a.invalidateActions=false}c.invalidate(b)}catch(d){}}};__IdCtrlNs.EPDataProvider.skipClass=true;__IdCtrlNs.EPDataProvider.registerClass("__IdCtrlNs.EPDataProvider","$Binding");__IdCtrlNs.EPDataProvider.requestId=0;$Binding.define("__IdCtrlNs.EPDataProvider").bindTo(document.body).attach()