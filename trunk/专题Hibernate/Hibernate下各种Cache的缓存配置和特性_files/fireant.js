/* Copyright (C) 2008 Microsoft Corporation */$Network.Fpp=function(p_strUrl,cfg){var defaultRetry=2,p_enumFlags=0,oFppHeaders={};oFppHeaders["Content-Type"]="application/x-www-form-urlencoded";if(typeof cfg=="undefined")cfg={};if(typeof cfg.ServerTunnelingUrl=="string"&&(typeof cfg.UseClientXmlProxy=="undefined"||cfg.UseClientXmlProxy==false))oFppHeaders["FPPRPURL"]=cfg.ServerTunnelingUrl;cfg.CommandType=cfg.CommandType||0;cfg.Version=cfg.Version||0;cfg.PartnerId=cfg.PartnerId||0;cfg.SessionId=cfg.SessionId||"";if(Object.isNumber(cfg.DefaultRetry))defaultRetry=cfg.DefaultRetry;if(Object.isBoolean(cfg.Notify)&&cfg.Notify)p_enumFlags=p_enumFlags|$Network.Flags.NOTIFY;if(Object.isBoolean(cfg.UseClientXmlProxy)&&cfg.UseClientXmlProxy)p_enumFlags=p_enumFlags|$Network.Flags.CLIENTPROXY;if(Object.isBoolean(cfg.AllowDuplicate)&&cfg.AllowDuplicate)p_enumFlags=p_enumFlags|$Network.Flags.DUPLICATE;oFppHeaders["X-FPP-Command"]=cfg.CommandType;function FppFinished(proxy,obj){$Network.Events.onfinished.fire(obj);var pkg={ErrorCode:0,Context:obj.context,Proxy:proxy,Error:null};obj.bRetry=false;try{if(proxy==null)pkg.ErrorCode=-4;else if(proxy.statusText==null||proxy.statusText=="")pkg.ErrorCode=-5;else if(proxy.status!=200&&proxy.status!=500)pkg.ErrorCode=-7}catch(a){pkg.ErrorCode=-5}if(pkg.ErrorCode!=0){if(++obj.nRetry<=defaultRetry){obj.bRetry=true;return}$Network.Events.onerror.fire(pkg);if(obj.cbErr)obj.cbErr(pkg.ErrorCode,pkg.Context,pkg.Proxy,pkg.Error)}else{try{var strUrl=proxy.getResponseHeader("FPPRPURL");if(strUrl!=""&&strUrl!=null)oFppHeaders["FPPRPURL"]=strUrl}catch(a){}try{var oFppPkg;if(cfg.CommandType==0)oFppPkg=eval(proxy.responseText);else if(cfg.CommandType==1)oFppPkg=eval("("+proxy.responseText+")");$Network.Events.onprofile.fire(oFppPkg.ProfilingInfo);if(oFppPkg.Status==0){var arrArgs=oFppPkg.OutRefParams;arrArgs.unshift(obj.context);arrArgs.unshift(oFppPkg.Value);obj.callback.apply(null,arrArgs)}else{pkg.ErrorCode=oFppPkg.Status;pkg.Error=oFppPkg.Error;$Network.Events.onerror.fire(pkg);if(obj.cbErr)obj.cbErr(pkg.ErrorCode,pkg.Context,pkg.Proxy,pkg.Error)}}catch(a){pkg.ErrorCode=-6;pkg.Error=a;if(++obj.nRetry<=defaultRetry){obj.bRetry=true;return}$Network.Events.onerror.fire(pkg);if(obj.cbErr)obj.cbErr(pkg.ErrorCode,pkg.Context,pkg.Proxy,pkg.Error)}}obj.bRetry=false}this.invoke=function(b,e,f,p,d,n,o,i,a,h){if(e==null||f==null||d==null)throw new Error("invalid arguments for $Network.Fpp");if(typeof d!="function")throw new Error("$Network.Fpp arg list mismatch:  cb must be of type function.");if(!h)h=Array.$Prioritizer.Priorities.High;var j="cn="+e+"&mn="+f+"&d="+p+"&v="+cfg.Version,k,c,g=$Network.defaultTimeout,m={context:n,callback:d,cbErr:o,bRetry:false,nRetry:0,bSave:false},l=p_strUrl.indexOf("?")>0?"&":"?";if(b==$Network.Type.XMLPost){k=j;c="{0}{1}cnmn={2}.{3}&ptid={4}&a={5}&au={6}".format(p_strUrl,l,e,f,cfg.PartnerId,cfg.SessionId,cfg.AuthUser)}else if(b==$Network.Type.XMLGet)c="{0}{1}{2}&ptid={3}&a={4}&au={5}".format(p_strUrl,l,j,cfg.PartnerId,cfg.SessionId,cfg.AuthUser);if(a)$Network.abortGroup(a);if(i)g=i;return $Network.fetch(FppFinished,(new $Request(c,b,p_enumFlags,m)).setHeaders(oFppHeaders).setPostString(k).setTimeout(g).setGroup(a).setCanary(cfg.CanaryToken))}};$Network.FppProxy=function(d){var c=this,b,a;this.initialize=function(h,d,e,f,a,b){var g={Version:0,CommandType:0,PartnerId:d,SessionId:e,ServerTunnelingUrl:f,UseClientXmlProxy:a,CanaryToken:b};return c.initializeEx(h,g)};this.initializeEx=function(e,d){b=new $Network.Fpp(e,d);a=d;return c};function f(e,b){function c(){var c={},g=b.length;for(var f=0;f<g;f++)c[b[f]]=arguments[f];c.toString=function(i){var f=[];if(a.CommandType==0&&i)f.push(d,".",e,":");f.push("{");for(var h=0;h<g;h++){if(a.CommandType==1)f.push(typeof b[h].toString()=="undefined"?b[h].type:b[h].toString(),":");f.push(b[h].escape(c[b[h]],a.Version,a.CommandType==0),",")}if(g>0)f.pop();f.push("}");return f.join("")};c.__isFppObject=true;return c}return c}function e(f,c,e,g,d){function h(){var j=[],i=c.length;for(var h=0;h<i;h++){if(a.CommandType==1)j.push(typeof c[h].toString()=="undefined"?c[h].type:c[h].toString(),":");j.push(c[h].escape(arguments[h],a.Version,a.CommandType==0),",")}if(i>0)j.pop();return b.invoke(e||$Network.Type.XMLPost,d,f,j.join(""),arguments[i],arguments[i+1],arguments[i+2],arguments[i+3],g)}return h}this.rfc=this.registerFppClass=function(a,b){this[a]=f(a,b)};this.rfm=this.registerFppMethod=function(a,g,d,c,f,b){this[a]=e(d||a,g,c||$Network.Type.XMLPost,f,b||strDefaultNamespace)};this.seal=function(){this.rfc=this.registerFppClass=this.rfm=this.registerFppMethod=this.seal=null}};new function(){var a=$Network.FppProxy;a.TypeSystem=function(b,a){this.toString=function(){return a};this.type=b;return this};a.dateToISO8601=function(b){var f="{0}-{1}-{2}T{3}:{4}:{5}",e=b.getHours(),c=b.getMinutes(),d=b.getSeconds();if(e<10)e="0"+e;if(c<10)c="0"+c;if(d<10)d="0"+d;return a.escape(f.format(b.getFullYear(),b.getMonth()+1,b.getDate(),e,c,d))};a.arrayToString=function(c,g,e){var f="";if(c==null)return f;if(Object.isArray(c)){var b=[];b.push("[");for(var d=0;d<c.length;d++){b.push(a.objToStringImpl(c[d],g,e));b.push(",")}if(c.length>0)b.pop();b.push("]");return b.join("")}else throw new Error("p_array = "+c+" is not an array");};a.escape=function(a,c){if(a==null)return a;else{var b="";if(c==0)b=encodeURIComponent(a.toString().replace(/([\{|\}\[|\]\,\\])/g,"\\$1"));else b=encodeURIComponent(('"'+a.toString()+'"').replace(/([\{|\}\[|\]\,\\:])/g,"\\$1"));return b}};a.objToStringImpl=function(c,e,d){var b=[];if(c==null||typeof c=="undefined"){if(d)b.push("null:");b.push("null")}else if(typeof c=="string"){if(d)b.push("System.String:");b.push(a.escape(c,e))}else if(c.constructor._typeName=="Date"){if(d)b.push("System.DateTime:");b.push(a.dateToISO8601(c))}else if(Object.isArray(c)){if(d)b.push("System.Array:");b.push(a.arrayToString(c,e,d))}else if(typeof c=="object")if(c.__isFppObject==true)b.push(c.toString(d));else{if(d)b.push("System.Collections.Hashtable:");b.push(a.objToString(c,e,d))}else{if(d)b.push("System.String:");b.push(c.toString())}return b.join("")};a.objToString=function(d,e,f){var b=["{"];for(var c in d)b.push(a.escape(c,e),":",a.objToStringImpl(d[c],e,f),",");b.pop();b.push("}");return b.join("")};a.TypeSystem.prototype.escape=function(b,c,d){if(b==null||typeof b=="undefined")return "null";switch(this.type){case "__string":return a.escape(b,c);case "__date":return a.dateToISO8601(b);case "__array":return a.arrayToString(b,c,false);case "__oArray":case "__object":return a.objToStringImpl(b,c,d);case "__primitive":case "__enum":return b;default:if(b.__isFppObject==true)return b;else return a.objToString(b,c,d)}};a.__string=function(b){return new a.TypeSystem("__string",b)};a.__date=function(b){return new a.TypeSystem("__date",b)};a.__array=function(b){return new a.TypeSystem("__array",b)};a.__oArray=function(b){return new a.TypeSystem("__oArray",b)};a.__primitive=function(b){return new a.TypeSystem("__primitive",b)};a.__object=function(b){return new a.TypeSystem("__object",b)};a.__enum=function(b){return new a.TypeSystem("__enum",b)};a.__custom=function(b,c){return new a.TypeSystem(b,c)};a.create=function(f,e){var a=window,d=f.split("."),g=d.length;for(var b=0;b<g-1;b++){var c=d[b];if(!a[c])a[c]=function(){};a=a[c]}a[d[b]]=new e};if(typeof Web!="undefined"){Web.Network.Fpp=$Network.Fpp;Web.Network.FppProxy=$Network.FppProxy}var c=$Network._fppProxies;for(var b=c.length-1;b>=0;b--){var d=c[b];a.create(d.type,d.classType)}$Network._fppReady=true};$Network.registerScript("FireAnt.js")