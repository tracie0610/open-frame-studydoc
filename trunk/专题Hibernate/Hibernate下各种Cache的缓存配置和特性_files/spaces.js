registerNamespace("Spaces.Comments");Spaces.Comments.Strings=new function(){this.comments_namerequired="\u8bf7\u8f93\u5165\u60a8\u7684\u540d\u5b57\u3002";this.blogjs_nametoolong="\u60a8\u8f93\u5165\u7684\u540d\u5b57\u592a\u957f\u3002\u8bf7\u7f29\u77ed\u540d\u5b57\uff0c\u7136\u540e\u518d\u8bd5\u3002";this.comments_invalidemail="\u8bf7\u6309\u4e0b\u5217\u683c\u5f0f\u8f93\u5165\u7535\u5b50\u90ae\u4ef6\u5730\u5740\uff1aname@example.com\u3002";this.blogjs_emailtoolong="\u60a8\u8f93\u5165\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u592a\u957f\u3002\u8bf7\u7f29\u77ed\u7535\u5b50\u90ae\u4ef6\u5730\u5740\uff0c\u7136\u540e\u518d\u8bd5\u3002";this.blogjs_urltoolong="\u60a8\u8f93\u5165\u7684\u7f51\u5740 (URL) \u592a\u957f\u3002\u8bf7\u7f29\u77ed\u7f51\u5740\uff0c\u7136\u540e\u518d\u8bd5\u3002";this.blogjs_commenttoolong="\u60a8\u8f93\u5165\u7684\u8bc4\u8bba\u592a\u957f\u3002\u8bf7\u7f29\u77ed\u8bc4\u8bba\uff0c\u7136\u540e\u5355\u51fb\u201c\u6dfb\u52a0\u201d{0}{1}";this.profile_lc_noAbDisplayName="\uff08\u6ca1\u6709\u540d\u5b57\uff09";this.comments_commentname="\u540d\u5b57\uff08\u5fc5\u586b\uff09\uff1a";this.comments_commentemail="\u7535\u5b50\u90ae\u4ef6\u5730\u5740\uff08\u5c06\u663e\u793a\uff09\uff1a";this.comments_commentblogurl="\u65e5\u5fd7\u7f51\u5740\uff1a";this.comments_commentshtmltext="\u8bc4\u8bba\uff08\u5fc5\u586b\uff09\uff1a";this.blogview_publishcomment="\u6dfb\u52a0";this.blogview_getonetoday="\u6ca1\u6709 Windows Live ID\uff1f{0}\u7acb\u5373\u6ce8\u518c{1}";this.blogview_servererror="\u670d\u52a1\u5668\u51fa\u73b0\u95ee\u9898\u3002\u8bf7\u518d\u8bd5\u3002";this.global_errorretrievingcontent="\u68c0\u7d22\u5185\u5bb9\u65f6\u51fa\u9519\u3002\u8bf7\u518d\u8bd5\u3002";this.comments_invalidcomment="\u60a8\u8f93\u5165\u7684\u8bc4\u8bba\u4e3a\u7a7a\u6216\u8005\u5305\u542b\u4e0d\u5141\u8bb8\u4f7f\u7528\u7684\u6587\u5b57\u3002\u8bf7\u91cd\u65b0\u8f93\u5165\u8bc4\u8bba\uff0c\u7136\u540e\u5355\u51fb\u201c\u6dfb\u52a0\u201d{0}{1}\u3002";this.blogview_passportsignin="\u82e5\u8981\u6dfb\u52a0\u8bc4\u8bba\uff0c\u60a8\u5fc5\u987b\u4f7f\u7528 Windows Live ID \u767b\u5f55\uff08Hotmail\u3001Messenger \u6216 MSN \u4e4b\u7c7b\u7684 Microsoft \u5e10\u6237\uff09\u3002";this.deleteblogitem_deleteerror="\u51fa\u73b0\u9519\u8bef\u3002\u4e00\u4e9b\u9879\u76ee\u53ef\u80fd\u6ca1\u6709\u5220\u9664\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002";this.deleteblogitem_comment_text="\u60a8\u5c06\u8981\u6c38\u4e45\u5220\u9664\u6b64\u8bc4\u8bba\u3002";this.deleteblogitem_comment_title="\u5220\u9664\u6b64\u8bc4\u8bba";this.homepage_signin="\u767b\u5f55";this.Photos_ShowContactPic="\u4f7f\u7528\u6211\u7684\u4e2a\u4eba\u8d44\u6599\u4fe1\u606f";this.comments_addwait="\u6b63\u5728\u6dfb\u52a0\u60a8\u7684\u8bc4\u8bba\uff0c\u8bf7\u7a0d\u5019\u3002"};registerNamespace("Spaces.Controls");Spaces.Controls.EntrySubContainer=function(e,d){Spaces.Controls.EntrySubContainer.initializeBase(this,arguments);d=this.getParameters();var a=this,b=e,c;this.controlBox=null;this.content=null;this.cns=d.cns;this.itemType=null;this.isOpen=false;this.initialize=function(){a.controlBox=$Dom.Css.getElementsByCssSelector(".ControlBox",e)[0];a.content=$Dom.Css.getElementsByCssSelector(".Content",e)[0];c=new $Memory.Groups;if(d.closebox=="1"){var b=this._setupButton(a.close,"close",d.closeboxtooltip,d.closeboxtooltip,null);if(a.controlBox)a.controlBox.appendChild(b)}Spaces.Controls.EntrySubContainer.callBaseMethod(this,"initialize",arguments)};this.dispose=function(d){Spaces.Controls.EntrySubContainer.callBaseMethod(this,"dispose",arguments);if(c){c.dispose(d);c=null}e=null;b=null;a.controlBox=null;a.content=null;a=null};this.isLoaded=function(){if(a.content&&a.content.innerHTML!="")return true;else return false};this.loadDefaultView=function(){};this.show=function(c,b){if(c||!a.isLoaded())a.loadDefaultView();f(b);a.isOpen=true};this.toggleDisplay=function(c,b){if(a.isOpen)a.close();else a.show(c,b)};var f=function(e){if(b.style.display=="none"||b.style.display=="")b.style.display="block";if(e){var f=Web.UI.getLocation(b),c=f.top+50,a=document.documentElement.scrollTop,d=document.documentElement.clientHeight;if(c<a||c>a+d)b.scrollIntoView(true)}};this.close=function(){b.style.display="none";a.isOpen=false;if(event)event.returnValue=false};this.revalidateAfterSectionOpen=function(d){var b;for(var c=d.childNodes.length-1;c>=0;c--){b=d.childNodes[c];if(b.tagName!=null&&b.tagName.toLowerCase()=="button"||b.className!=null&&b.className.toLowerCase()=="ccui"||b.className!=null&&b.className.toLowerCase()=="hoverbutton"||b.className!=null&&b.className.toLowerCase()=="notify"||b.className!=null&&b.className.toLowerCase().indexOf("identctrl")>-1)$Binding.validate(b);if(b.childNodes.length>0)a.revalidateAfterSectionOpen(b)}};this.removeBindingsDeep=function(b,e){if(b.childNodes)for(var c=0;c<b.childNodes.length;c++){var d=b.childNodes[c];if(d)a.removeBindingsDeep(d,true)}if(e)try{$Binding.remove(b)}catch(f){}};this._setupButton=function(g,e,h,j,i){var a=document.createElement("a");a.href="#";c.create(null).Events.register(a,{onclick:g});var b=document.createElement("img"),d=$Config.Themes.url+"hig/img/";b.src=d+"glyph/"+e+"_rest_~BodyTextLuminance~.gif";b.alt=j;a.img=b;a.title=h;a.appendChild(b);a.style.display=i?"none":"";var f=new Spaces.Controls.HoverButton(b,{hoversrc:d+"glyph/"+e+"_hover_~BodyTextLuminance~.gif"});c.create(null).Properties.register(f);return a};$Spaces.registerAllBaseMethods(Spaces.Controls.EntrySubContainer,this)};Spaces.Controls.EntrySubContainer.registerClass("Spaces.Controls.EntrySubContainer","$Binding");Spaces.Controls.EntrySubContainer.skipClass=true;Spaces.Controls.EntrySubContainer.Params=new $Enum("cns","closebox","closeboxtooltip");Spaces.Comments.CommentsView=function(B,a){Spaces.Comments.CommentsView.initializeBase(this,arguments);a=this.getParameters();var u=Spaces.Comments.Strings,h=Spaces.Utility.GetString,b=this,A=B,s,L,w,x,G,i,t,I=Number.coerceInt(a.pagesize),n=Number.coerceInt(a.commentcount),z,y=a.viewmode,g,o,r,q,p,f,j,m,l,k,F,D,c,v,d;this.forceGetComment=false;var C=10000;this.initialize=function(e){b.itemType="comment";s=new $Memory.Groups;var d=$Dom.Css.getElementsByCssSelector("span.PagingControlBox",B);g=d[0];f=d[1];w=a.nexthandle;x=a.prevhandle;L=a.pagetype;z=document.getElementById("ccCount");v=0;if(a.multidelete=="True")c=$Dom.Css.getElementsByCssSelector("input.multiDelCB",B);Spaces.Comments.CommentsView.getBaseMethod(this,"initialize","Spaces.Controls.EntrySubContainer").call(this,e);G=this.controlBox;i=this.content;K();E();if(a.display=="1")b.show(false,a.scroll=="1"?true:false);b.registerFor("Spaces.Controls.NotificationBar",J,A);s.create(null).Events.register(i,{onclick:P})};this.dispose=function(a){Spaces.Comments.CommentsView.getBaseMethod(this,"dispose","Spaces.Controls.EntrySubContainer").call(this,a);if(s){s.dispose(a);s=null}B=null;A=null;if(F)F=null;if(D)D=null;G=null;i=null;d=null};function J(b,a){if(a){d=b;d.hide()}else d=null}function K(){o=b._setupButton(e,"beginningend_~Left~",a.firsttooltip,a.firsttooltip,true);o.setAttribute("action","First");o.id="commentsFirstPageTop";j=b._setupButton(e,"beginningend_~Left~",a.firsttooltip,a.firsttooltip,true);j.setAttribute("action","First");j.id="commentsFirstPageBottom";r=b._setupButton(e,"backnext_~Left~",a.prevtooltip,a.prevtooltip,true);r.setAttribute("action","Prev");r.id="commentsPrevPageTop";m=b._setupButton(e,"backnext_~Left~",a.prevtooltip,a.prevtooltip,true);m.setAttribute("action","Prev");m.id="commentsPrevPageBottom";q=b._setupButton(e,"backnext_~Right~",a.nexttooltip,a.nexttooltip,true);q.setAttribute("action","Next");q.id="commentsNextPageTop";l=b._setupButton(e,"backnext_~Right~",a.nexttooltip,a.nexttooltip,true);l.setAttribute("action","Next");l.id="commentsNextPageBottom";p=b._setupButton(e,"beginningend_~Right~",a.lasttooltip,a.lasttooltip,true);p.setAttribute("action","Last");p.id="commentsLastPageTop";k=b._setupButton(e,"beginningend_~Right~",a.lasttooltip,a.lasttooltip,true);k.setAttribute("action","Last");k.id="commentsLastPageBottom";if(g){g.style.paddingRight="3px";g.appendChild(o);g.appendChild(r);g.appendChild(q);g.appendChild(p)}if(f){f.style.paddingRight=a.closebox=="1"?"20px":"9px";f.appendChild(j);f.appendChild(m);f.appendChild(l);f.appendChild(k)}}function E(){if(w)p.style.display=k.style.display=l.style.display=q.style.display="";else p.style.display=k.style.display=l.style.display=q.style.display="none";if(x)o.style.display=j.style.display=m.style.display=r.style.display="";else o.style.display=j.style.display=m.style.display=r.style.display="none"}this.setViewMode=function(a){y=a};function e(){event.returnValue=false;var a;d.hide();if(event.srcElement.tagName=="IMG")a=event.srcElement.parentElement.getAttribute("action");else a=event.srcElement.getAttribute("action");if(a=="Next")b.getComments(w,"Next");else if(a=="Prev")b.getComments(x,"Previous");else if(a=="First")b.getComments(null,"First");else if(a=="Last")b.getComments(null,"Last");b.fire("onpagingclick",a)}function M(){t=false;d.show(Spaces.Controls.NotificationBar.Importance.High,true,h(u,"global_errorretrievingcontent"))}function H(d){b.removeBindingsDeep(i);i.innerHTML=d.Html;w=d.NextHandle;x=d.PrevHandle;n=d.CCount;z.innerHTML=n;v=0;b.revalidateAfterSectionOpen(i);if(a.multidelete=="True");c=$Dom.Css.getElementsByCssSelector("input.multiDelCB",i);if(A.style.display=="none")A.style.display="";E();t=false}this.emitComments=function(a){H(a)};this.getComments=function(d,c){if(t||y=="None")return;t=true;Spaces.Comments.GetFppService().get_comments(b.cns,a.photoalbumhandle,d,I,c,y,a.sortorder,a.moduletype,a.closebox,a.allowdeletecomment,a.multidelete,$Config.Themes.current,this.forceGetComment?(new Date).toString():g_spLastMTime,H,null,M,C);b.forceGetComment=false};function P(){var a,c;d.hide();if(event.srcElement.tagName=="IMG"){a=event.srcElement.parentElement.getAttribute("action");c=event.srcElement.parentElement.getAttribute("handle")}else{a=event.srcElement.getAttribute("action");c=event.srcElement.getAttribute("handle")}if(a=="close"){event.returnValue=false;b.close()}else if(a=="singleDelete"){event.returnValue=false;O(c)}else if(a=="multiDelete")b.fire("oncheckboxclick",event.srcElement)}function O(a){var e="None",i=h(u,"deleteblogitem_comment_text"),g=h(u,"deleteblogitem_comment_title");function c(){var c=[];c.push(a);b.fire("ondialogdismiss");function f(){d.show(Spaces.Controls.NotificationBar.Importance.High,true,h(u,"deleteblogitem_deleteerror"));return false}function e(){var c=document.getElementById("_ci"+a);v++;if(c.parentElement.childNodes.length==v)b.getComments(null,"First");else if(c!=null){c.style.display="none";n--;z.innerHTML=n}}Spaces.Comments.GetFppService().delete_items(c,e,null,f,C);b.forceGetComment=true}var f=new SimpleDialogData(name,null,null,null,i+"<p>"+h(Spaces.Common.Strings,"global_cannotbeundone")+"</p>",h(Spaces.Common.Strings,"global_delete"),h(Spaces.Common.Strings,"global_cancel"));b.fire("ondeleteclick");Spaces.PopOvers.SimplePopOverWithCancelCB(e,g,f,null,c,N)}function N(){b.fire("ondialogdismiss")}b.deleteMultiComment=function(a,d){function e(){for(var d=0;d<a.length;d++){var f=document.getElementById("_ccb"+a[d]);if(f){var e=c.indexOf(f);if(e>-1)c.splice(e,1)}}if(c.length==0)b.getComments(null,"First");else{for(var d=0;d<a.length;d++){var g=document.getElementById("_ci"+a[d]);if(g!=null)g.style.display="none"}n-=a.length;z.innerHTML=n}}if(typeof d=="undefined")d=null;Spaces.Comments.GetFppService().delete_items(a,e,null,d,C);b.forceGetComment=true};b.getMultiDeleteList=function(){var b=[];for(var a=c.length-1;a>=0;a--)if(c[a].checked){cHandle=c[a].getAttribute("handle");b.push(cHandle)}return b};b.setMultiDeleteCBs=function(d,e){for(var a=0;a<c.length;a++){if(d&&e){if(!c[a].checked)c[a].checked=true}else if(!d)c[a].checked=false;c[a].disabled=d}return b.getMultiDeleteList()};b.getCommentsSettings=function(){return {PhotoAlbumId:a.photoalbumhandle,PageSize:I,CommentMode:y,SortOrder:a.sortorder,ModuleType:a.moduletype,CloseBox:a.closebox,AllowDeleteComment:a.allowdeletecomment,MultiDelete:a.multidelete,CurrentTheme:$Config.Themes.current}};this.loadDefaultView=function(){return b.getComments()}};Spaces.Comments.CommentsView.registerClass("Spaces.Comments.CommentsView","Spaces.Controls.EntrySubContainer");Spaces.Comments.CommentsView.skipClass=true;Spaces.Comments.CommentsView.Params=new $Enum("cns","moduletype","photoalbumhandle","viewmode","display","closebox","closeboxtooltip","firsttooltip","prevtooltip","nexttooltip","lasttooltip","scroll","pagesize","commentcount","allowdeletecomment","multidelete","sortorder","prevhandle","nexthandle","pagetype");Spaces.Comments.CommentsView.Events=new $Enum("onpagingclick","oncheckboxclick","ondeleteclick","ondialogdismiss");registerNamespace("Spaces.Comments");var gblMsnScriptTimeout=false;Spaces.Comments.AddComment=function(p,b){Spaces.Comments.AddComment.initializeBase(this,arguments);b=this.getParameters();var i,d=this,o=p,a=null,j=null,h=null,k=null,g,w=b.viewmode,c=Spaces.Comments.Strings,f=Spaces.Utility.GetString;this.initialize=function(c){d.itemType="AddComment";i=new $Memory.Groups;a=b.cns;j=b.returnurl;h=b.signin;k=b.getonetoday;Spaces.Comments.AddComment.getBaseMethod(this,"initialize","Spaces.Controls.EntrySubContainer").call(this,c);if(b.display=="1")d.show(b.scroll=="1"?true:false);i.create(null).Events.register(d.content,{onclick:x});d.registerFor("Spaces.Comments.CommentsView",q)};this.dispose=function(a){if(i){i.dispose(a);i=null}g=null;p=null;o=null;d=null;Spaces.Comments.AddComment.getBaseMethod(this,"dispose","Spaces.Controls.EntrySubContainer").call(this,a)};function q(b,a){if(a)g=b;else g=null}this.isLoaded=function(){return false};this.loadDefaultView=function(){return t()};this.setItemId=function(b){if(b)a=b};this.setPhotoIndexInUrl=function(a,c){j=b.returnurl.replace(a,c);h=b.signin.replace(a,c);k=b.getonetoday.replace(a,c)};var x=function(){var a=event.srcElement.getAttribute("action");if(a=="close"){event.returnValue=false;d.close()}else if(a=="post"){event.returnValue=false;v()}else if(a=="cc")m();else if(a=="signIn"){event.returnValue=false;l(h)}else if(a=="signUp"){event.returnValue=false;l(k)}},s=function(){var g,d=new $StringBuilder(""),i=false,e=a.encodeHtml();if(b.cid!="0")i=true;if(b.isauthenticated=="True"){g=false;var k=g?"bvSectionContentG":"bvSectionContentPC";d.append('<div class="'+k+'">');d.append('<div id="Err'+e+'" class="Err"></div>');var j="";if(w=="Mid")j=" width:{0}px;".format(o.parentNode.offsetWidth-24);d.append(r());d.append('<div class="bvPostCommentInner">');d.append('<label id="lblName'+e+'" for="txtName'+e+'" style="'+(i?"display:none ":"")+'">'+f(c,"comments_commentname").encodeHtml()+"</label>");d.append('<div class="InputWrapper ccAddFieldWrapper" style="'+j+(i?"display:none ":"")+'" ><input type="text" style="line-height:normal" id="txtName'+e+'" name="txtName'+e+'" maxlength='+b.c_name+' value="'+f(c,"profile_lc_noAbDisplayName")+'"></div>');d.append('<label for="txtEmail'+e+'">'+f(c,"comments_commentemail").encodeHtml()+"</label>");d.append('<div class="InputWrapper ccAddFieldWrapper" style="'+j+'"><input type="text" style="line-height:normal" '+(g?'readonly="True" ':"")+(g?" disabledText":"")+'" id="txtEmail'+e+'" name="txtEmail'+e+'" value="" maxlength='+b.c_email+"></div>");d.append('<label id="lblURL'+e+'" for="txtURL'+e+'" style="'+(i?"display:none ":"")+'">'+f(c,"comments_commentblogurl").encodeHtml()+"</label>");d.append('<div class="InputWrapper ccAddFieldWrapper" style="'+j+(i?"display:none ":"")+'" ><input type="text" class="LTRbox" style="line-height:normal" id="txtURL'+e+'" name="txtURL'+e+'" value="'+b.visitorurl.encodeHtml()+'" maxlength='+b.c_url+"></div>");d.append('<label for="txtComment'+e+'">'+f(c,"comments_commentshtmltext").encodeHtml()+"</label>");d.append('<table style="table-layout:fixed; width:100%" cellspacing="0"><tr><td><div class="COMMENTENTRY"><textarea class="rtecomment" id="txtComment'+e+'" name="txtComment'+e+'" '+(g?"readonly":"")+' value="" ></textarea></div></td></tr></table>');d.append('<div class="ccButtonBar">');d.append('<button id="commAdd'+e+'" type="submit" action="post" class="Default" '+(g?'disabled="0"':"")+">"+f(c,"blogview_publishcomment").encodeHtml()+"</button>");d.append("&nbsp;");d.append('<button id="commCancel'+e+'" type="button" action="close" '+(g?'disabled="0"':"")+">"+f(Spaces.Common.Strings,"global_cancel").encodeHtml()+"</button>");d.append("</div></div></div>")}else{h=h.replace("tpf","tpfbak");d.append('<div class="Notify" nb:importance="Med" nb:fullwidth="1" style="margin-bottom:0px; border-bottom:none">');d.append("<span>"+f(c,"blogview_passportsignin").encodeHtml());d.append(' <a href="#" id="si'+e+'" action="signIn">'+f(c,"homepage_signin").encodeHtml()+"</a>");d.append("</span><div>");d.append(f(c,"blogview_getonetoday").encodeHtml().format('<a href="#" action="signUp">',"<a>"));d.append("</div></div>")}return d.toString()},m=function(){var f=document.getElementById("lblName"+a),c=document.getElementById("txtName"+a),g=document.getElementById("lblURL"+a),d=document.getElementById("txtURL"+a),i=document.getElementById("txtShowContactControl"+a),e=document.getElementById("addcommentcontrol"+a);if(f!=null&&c!=null&&g!=null&&d!=null&&i!=null&&e!=null){var h=b.userdisplayname;if(ValidateNonEmptyString(h))c.value=h;d.value=b.visitorurl;if(b.cid)if(c.value!=null&&d.value!=null)if(i.checked){e.style.visibility="visible";f.style.display="none";c.parentElement.style.display="none";g.style.display="none";d.parentElement.style.display="none"}else{e.style.visibility="hidden";f.style.display="";c.parentElement.style.display="";g.style.display="";d.parentElement.style.display=""}else{if(c){c.readOnly=false;c.className=c.className.removeSpaceDelimitedString("disabledText")}if(d){d.readOnly=false;d.className=d.className.removeSpaceDelimitedString("disabledText")}txtShowContact.disabled=true;txtShowCOntact.checked=false}else{e.style.visibility="hidden";c.readOnly=true;d.readOnly=true;if(c.className.indexOf("disabledText")==-1)c.className+=" disabledText";if(d.className.indexOf("disabledText")==-1)d.className+=" disabledText"}}},r=function(){var d;d="<table>"+'<tr><td style="vertical-align:top; height:71px; width:49px;"><div id="addcommentcontrol'+a+'">'+b.visitorcchtml+"</div></td>"+'<td><input action="cc" type="checkbox" name="txtShowContactControl{0}" id="txtShowContactControl{0}" checked="true" /><label for="txtShowContactControl{0}"> {1}</label></td></tr></table>';return d.format(a.toString(),Spaces.Utility.GetString(c,"Photos_ShowContactPic"))},t=function(){var e=s();e=e.replace("spacesbeid",a);d.content.innerHTML=e;d.revalidateAfterSectionOpen(d.content);if(b.isauthenticated=="True"){var f=document.getElementById("txtComment"+a);if(f!=null)window.setTimeout(function(){$Binding.validate(f)},1);var c=document.getElementById("txtName"+a),h=document.getElementById("txtEmail"+a);if(c!=null&&c.readOnly==false)if(c.value.length==0)c.focus();else{function g(){try{h.focus()}catch(a){}}window.setTimeout(g,1)}if(document.getElementById("txtShowContactControl"+a)!=null)m()}else window.setTimeout(function(){document.getElementById("si"+a).focus()},1)},e=function(b,a){return '<div class="Notify" nb:importance="'+a+'" nb:fullwidth="true">'+b+"</div>"},v=function(){var l=document.getElementById("txtName"+a),j=document.getElementById("txtEmail"+a),o=document.getElementById("txtURL"+a),h=document.getElementById("txtComment"+a),w=document.getElementById("txtShowContactControl"+a),s=document.getElementById("commAdd"+a),x=document.getElementById("commCancel"+a),f="";if(s.disabled)return;var v=ValidateNonEmptyString(l.value);if(!v||l.value.length>b.c_name)if(f.length==0)l.focus();if(!v)f+=e(Spaces.Utility.GetString(c,"comments_namerequired"),"High");else if(l.value.length>b.c_name)f+=e(Spaces.Utility.GetString(c,"blogjs_nametoolong"),"High");var t=ValidateEmail(j.value);if(ValidateNonEmptyString(j.value)&&!t||j.value.length>b.c_email)if(f.length==0)j.focus();if(ValidateNonEmptyString(j.value)&&!t)f+=e(Spaces.Utility.GetString(c,"comments_invalidemail"),"High");else if(j.value.length>b.c_email)f+=e(Spaces.Utility.GetString(c,"blogjs_emailtoolong"),"High");if(o.value.length>b.c_url){if(f.length==0)o.focus();f+=e(Spaces.Utility.GetString(c,"blogjs_urltoolong"),"High")}var p=!h.RichEdit||h.RichEdit&&h.RichEdit.HasContents();if(h.RichEdit)h.value=h.RichEdit.GetValue();var q=h.value.trim().length,k=document.createElement("div");k.innerHTML=h.value;var r=0!=k.innerText.trim().length||0!=k.getElementsByTagName("IMG").length||0!=k.getElementsByTagName("EMBED").length||0!=k.getElementsByTagName("IFRAME").length;k.innerHTML="";if(!r||q>b.c_comment||!p)if(f.length==0)try{h.focus()}catch(y){}if(!r||!p)f+=e(Spaces.Utility.GetString(c,"comments_invalidcomment").encodeHtml().format("<b>","</b>"),"High");else if(q>b.c_comment)f+=e(Spaces.Utility.GetString(c,"blogjs_commenttoolong").encodeHtml().format("<b>","</b>"),"High");if(f.length>0){var m=document.getElementById("Err"+a);m.innerHTML=f;d.revalidateAfterSectionOpen(m);return}var m=document.getElementById("Err"+a);m.innerHTML=e(Spaces.Utility.GetString(c,"comments_addwait").encodeHtml(),"Low");d.revalidateAfterSectionOpen(m);var i=g.getCommentsSettings();s.disabled=true;x.disabled=true;Spaces.Comments.GetFppService().add_comment(a,i.PhotoAlbumId,l.value,o.value,j.value,h.value,w.checked,i.PageSize,i.CommentMode,i.SortOrder,i.ModuleType,i.CloseBox,i.AllowDeleteComment,i.MultiDelete,i.CurrentTheme,u,null,n,20000)};function u(b){if(!b)n();if(b.IsFssRestrictedComment){var c=document.getElementById("Err"+a);c.innerHTML=e(b.FssAddCommentRestrictedMessage,"High");d.revalidateAfterSectionOpen(c);return}d.close();d.removeBindingsDeep(d.content);d.content.innerHTML="";if(g){g.emitComments(b);g.show(false,false)}}function n(g,h,i,f){if(f&&f.Code&&f.Code.toLowerCase()=="itemcontainsprofanity"){var b=document.getElementById("Err"+a);b.innerHTML=e(Spaces.Utility.GetString(c,"blogview_containsprofanity"),"High");d.revalidateAfterSectionOpen(b)}else{var b=document.getElementById("Err"+a);b.innerHTML=e(Spaces.Utility.GetString(c,"blogview_servererror"),"High");d.revalidateAfterSectionOpen(b)}document.getElementById("commAdd"+a).disabled=false;document.getElementById("commCancel"+a).disabled=false}function l(c){var d=j.replace("spacesbeid",a),b=window.location.hostname.substring(window.location.hostname.indexOf("."));document.cookie="wlru="+d+";path=/;domain="+b+";";document.location=c}};Spaces.Comments.AddComment.registerClass("Spaces.Comments.AddComment","Spaces.Controls.EntrySubContainer");Spaces.Comments.AddComment.skipClass=true;Spaces.Comments.AddComment.Params=new $Enum("cns","display","closebox","closeboxtooltip","scroll","c_name","c_url","c_email","c_comment","cid","visitorurl","visitorcchtml","userdisplayname","isauthenticated","getonetoday","signin","returnurl","viewmode");registerNamespace("Spaces.Comments");Spaces.Comments._fppService=null;Spaces.Comments.GetFppService=function(){if(!Spaces.Comments._fppService){var a=new CommentsService.FppProxySettings;a.Version=CommentsService.FppVersion.TWO;a.CanaryToken=C_CANARY_COOKIE_NAME;Spaces.Comments._fppService=CommentsService.initializeEx("http://"+window.location.hostname+"/parts/sharedcontrols/CommentControl/CommentsService.fpp",a)}return Spaces.Comments._fppService};$Network.registerFpp("CommentsService",function(){var f=$Network.FppProxy,a=f.__string,b=f.__primitive,d=f.__array,i=f.__custom,e=f.__enum,j=f.__date,g=f.__object,h=f.__oArray,c=new $Network.FppProxy("CommentsService");c.ModuleType=new $Flags("Undefined",0,"Blogs",1,"Photos",2,"Guestbook",3);c.CommentsDisplayMode=new $Flags("Undefined",0,"Narrow",1,"Mid",2,"Wide",3,"Preview",4);c.rfc("SpaceItemComments",[a("Html"),a("PrevHandle"),a("NextHandle"),b("CCount"),b("IsFssRestrictedComment"),a("FssAddCommentRestrictedMessage")]);c.InviteReturnCodes=new $Flags("Success",0,"GenericError",1,"InputValidationError",2,"QuotaExceeded",3,"QuotaEmpty",4,"ABCHError_CanRetry",5,"ABCHError_NoRetry",6);c.rfc("InviteReturnData",[e("Code"),a("Detail"),a("DisplayMessage")]);c.FindFriendSort=new $Flags("Unsorted",0,"Sorted",1,"Random",2);c.FindFriendFilter=new $Flags("AllFriends",0,"InvitedFriends",1,"MutualFriends",2,"NonMutualFriends",3);c.rfc("FindOptions",[b("OpenDefaultActionsInNewWindow"),e("SortFriends"),b("MaxFriendCount"),b("IncludeTags"),b("IncludeNotes"),b("IncludeFans"),b("MarkMutualFriends"),e("FriendFilter"),a("Theme"),b("PageSize"),b("Page"),b("CanEdit"),b("FullSize"),b("ShouldPivot"),a("FilterTag"),a("DefaultClickActionRelativeUrl")]);c.rfc("__0",[a("FUCID"),a("DisplayName"),a("EMail"),b("MembershipId"),b("IsFan"),b("IsSponsored"),a("Comments"),d("Tags"),b("SortOrder"),a("IdentityUI"),b("IsMutualFriend")]);c.FindFriendReturn=new $Flags("Failure",0,"Success",1,"AccessDenied",2,"AccessDeniedAnonymous",3);c.rfc("__1",[a("BrowseUserId"),d("Friends"),d("Tags"),e("HRESULT"),b("TotalFriendCount"),a("OwnerName"),a("OwnerUI"),a("UserUI"),a("UserName")]);c.rfc("FriendRenderResult",[a("BrowseUserId"),d("Friends"),d("IdentityUI"),d("DisplayName")]);c.rfc("RenderData",[a("FUCID"),a("EMail"),a("DisplayName"),a("Comments"),d("Tags")]);c.rfc("RenderOptions",[a("Theme"),b("OpenDefaultActionsInNewWindow"),b("CanEdit"),b("FullSize"),b("ShouldPivot"),d("Data"),a("DefaultClickActionRelativeUrl")]);c.rfc("__2",[a("Name")]);c.rfc("__3",[a("Category"),a("Message")]);c.rfc("__4",[d("m_serverTraceCollection")]);c.FppStatus=new $Flags("SUCCESS",0,"ERR_HTTP_MISCONFIGURATION",-7,"ERR_HTTP_PARSE_FAILURE",-6,"ERR_HTTP_CONNECT_FAILURE",-5,"ERR_HTTP_TIMEOUT",-4,"ERR_SERVER_UNCAUGHT",-3,"ERR_APP_SPECIFIC",-2,"ERR_FPP_PROTOCOL",-1);c.rfc("FppError",[a("ErrorCode"),a("Message"),g("ErrorObj"),a("StackTrace")]);c.rfc("FppReturnPackage",[e("Status"),g("Value"),h("OutRefParams"),i(c.FppError,"Error"),g("ProfilingInfo")]);c.FppCommandType=new $Flags("FPP",0,"FPP_JSON",1,"FPP_RP",2,"FPP_RP_JSON",3);c.FppVersion=new $Flags("BASE",0,"ONE",1,"TWO",2,"CURRENT",2);c.rfc("FppProxySettings",[e("Version"),e("CommandType"),a("PartnerId"),a("SessionId"),a("AuthUser"),a("ServerTunnelingUrl"),b("UseClientXmlProxy"),a("CanaryToken"),b("DefaultRetry"),b("Notify"),e("DateType")]);c.FppDateType=new $Flags("Local",0,"UTC",1);c.rfm("get_comments",[a("storageItemHandle"),a("photoAlbumHandle"),a("firstCommentHandle"),b("commentsCount"),a("pageType"),a("commentMode"),a("sortOrder"),a("storageItemType"),a("isClosable"),b("allowDeleteComment"),b("isMultidelete"),a("theme"),a("cacheToken")],"get_comments",$Network.Type.XMLGet,null,"Microsoft.Spaces.Web.Controls.CommentsService");c.rfm("add_comment",[a("storageItemHandle"),a("photoAlbumHandle"),a("authorName"),a("authorUrl"),a("authorEmail"),a("commentText"),b("showContactControl"),b("pageSize"),a("commentMode"),a("sortOrder"),a("storageItemType"),a("isClosable"),b("allowDeleteComment"),b("isMultidelete"),a("theme")],"add_comment",$Network.Type.XMLPost,null,"Microsoft.Spaces.Web.Controls.CommentsService");c.rfm("delete_items",[d("commentHandles")],"delete_items",$Network.Type.XMLPost,null,"Microsoft.Spaces.Web.Controls.CommentsService");c.seal();return c})