<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="keywords" content="blog,yulog">
  <title>struts中上传文件-FormFile应用 
  </title>
  
  <link href="/usage/skin/user/lunzi.css" type="text/css" rel="stylesheet" id="Any"></link>
</head>


<body id="Body">

<div id="wrap">
<div id="container">
<div id="banner"><h1>lunzi</h1><h2> 勇者无所畏惧   强者自强不息                            </h2></div>
 

<div id="nav">



<span raw="true" id="navList">      
 <a href="http://www.zhuoda.org/hofman/" id="Any_0">
  hofman&nbsp;</a>
</span><span raw="true" id="navList_0">      
 <a href="http://jc.aomeisoft.com/" id="Any_1">
  神州竞猜&nbsp;</a>
</span><span raw="true" id="navList_1">      
 <a href="http://www.zhuoda.org/haohao/" id="Any_2">
  haohao&nbsp;</a>
</span><span raw="true" id="navList_2">      
 <a href="http://www.zhuoda.org/dezi/" id="Any_3">
  德子&nbsp;</a>
</span><span raw="true" id="navList_3">      
 <a href="http://www.zhuoda.org/yxblium/" id="Any_4">
  荒 原&nbsp;</a>
</span><span raw="true" id="navList_4">      
 <a href="http://www.zhuoda.org/coffee/" id="Any_5">
  coffee&nbsp;</a>
</span><span raw="true" id="navList_5">      
 <a href="http://hi.baidu.com/fxn9801" id="Any_6">
  秘密花园&nbsp;</a>
</span><span raw="true" id="navList_6">      
 <a href="http://www.shentongka.com/" id="Any_7">
  神州卡服务平台&nbsp;</a>
</span><span raw="true" id="navList_7">      
 <a href="http://www.okajax.com/info/codedown/" id="Any_8">
  ajax中国&nbsp;</a>
</span><span raw="true" id="navList_8">      
 <a href="http://bbs.aomeisoft.com" id="Any_9">
  神州论坛&nbsp;</a>
</span><span raw="true" id="navList_9">      
 <a href="http://www.oksonic.cn/" id="Any_10">
  oksonic&nbsp;</a>
</span><span raw="true" id="navList_10">      
 <a href="http://china.nba.com/" id="Any_11">
  NBA中文官方网站&nbsp;</a>
</span><span raw="true" id="navList_11">      
 <a href="http://www.scbr.com/docs/products/dhtmlxTreeGrid/index.shtml" id="Any_12">
  js实现tree&nbsp;</a>
</span><span raw="true" id="navList_12">      
 <a href="http://blog.csdn.net/houhy" id="Any_13">
  houhy &nbsp;</a>
</span><span raw="true" id="navList_13">      
 <a href="http://blogger.org.cn/blog/more.asp?name=lhwork&amp;id=32876" id="Any_14">
  李焕搏克&nbsp;</a>
</span><span raw="true" id="navList_14">      
 <a href="http://www.zcool.com.cn/" id="Any_15">
  酷站素材&nbsp;</a>
</span><span raw="true" id="navList_15">      
 <a href="http://www.yeeyan.com/" id="Any_16">
  译文&nbsp;</a>
</span>

</div>

<div id="right">
<div class="sidebar">

<div id="sideNav">
<h2>导航</h2>


<ul>
<li>   <a href=/lunzi/dir_7674.html>总目录&nbsp;&nbsp;</a> &nbsp;
       <a href="/app">青草地</a>
 </li>

<li> <a href="/lunzi/">lunzi</a> &nbsp;
     <a href=/photo/lunzi/>主人相册</a> &nbsp;
  </li>
  <li>  <a href="/lunzi.rss"><img  src="/images/xml.gif"/></a>&nbsp;
    <a href="/blog/PostAction!input.action">发文&nbsp;</a>    
     <a href="/blog/admin/index.jsp">管理</a>
  </li>
  </ul>

</div>

<div id="menu">


<h3><a href="/lunzi/cat37674.html ">struts学习</a> </h3>
<ul>
<li id="catPostList_0"> 
<a href="/lunzi/62154.html">struts中的常量类(date)</a>
</li><li id="catPostList_1"> 
<a href="/lunzi/62047.html">struts 的Validator</a>
</li><li id="catPostList_2"> 
<a href="/lunzi/61943.html">struts ActionForm 中的valid</a>
</li><li id="catPostList_3"> 
<a href="/lunzi/61752.html">struts中上传文件-FormFile应用</a>
</li><li id="catPostList_4"> 
<a href="/lunzi/60524.html">struts 错误提示乱码问题</a>
</li><li id="catPostList_5"> 
<a href="/lunzi/59775.html">DispatchAction应用</a>
</li><li id="catPostList_6"> 
<a href="/lunzi/59586.html">解决插入数据库中文乱码问题</a>
</li><li id="catPostList_7"> 
<a href="/lunzi/59344.html">一个参数多个动作的action</a>
</li><li id="catPostList_8"> 
<a href="/lunzi/59358.html">struts+hiberante学习手记</a>
</li><li id="catPostList_9"> 
<a href="/lunzi/59356.html">struts视图文件</a>
</li><li id="catPostList_10"> 
<a href="/lunzi/59354.html">struts管理部署文件</a>
</li><li id="catPostList_11"> 
<a href="/lunzi/59352.html">hibernate的持久类及映射文件</a>
</li><li id="catPostList_12"> 
<a href="/lunzi/59350.html">用hibernate封装数据库DAO</a>
</li><li id="catPostList_13"> 
<a href="/lunzi/59342.html">hibernate连接数据库文件</a>
</li><li id="catPostList_14"> 
<a href="/lunzi/55006.html">struts介绍(资料)</a>
</li><li id="catPostList_15"> 
<a href="/lunzi/55004.html">Struts原理、开发及项目实施(资料)</a>
</li><li id="catPostList_16"> 
<a href="/lunzi/40775.html">有点意外</a>
</li><li id="catPostList_17"> 
<a href="/lunzi/37677.html">利用Myeclipse快速开发struts应用程序</a>
</li></ul>

</div>

</div>
</div>

<div id="center">
<div class="content">

<span id="If">
<div class="postTitle">
struts中上传文件-FormFile应用
</div>
</span>

<div class="postText">
<pre>今天花了点时间学习了一下struts的commons-fileupload.jar,在网上找了个例子,用MyEclipse重新开发了一个,大约用时两个小时,算是ok了!下面是系统应用的部分代码:<br>UploadsActionAction.java<br><br>&nbsp;&nbsp;</font><font size=2 color="#0000aa"><i>//Created by MyEclipse Struts</font></i><font size=2 color=black><br></font><font size=2 color="#0000aa"><i>// XSL source (default): platform:/plugin/com.genuitec.eclipse.cross.easystruts.eclipse_4.1.1/xslt/JavaClass.xsl</font></i><font size=2 color=black><br><br><font size=2 color=blue>package</font> struts.action;<br><br><font size=2 color=blue>import</font> javax.servlet.http.HttpServletRequest;<br><font size=2 color=blue>import</font> javax.servlet.http.HttpServletResponse;<br><br><font size=2 color=blue>import</font> org.apache.struts.action.Action;<br><font size=2 color=blue>import</font> org.apache.struts.action.ActionForm;<br><font size=2 color=blue>import</font> org.apache.struts.action.ActionForward;<br><font size=2 color=blue>import</font> org.apache.struts.action.ActionMapping;<br><br><font size=2 color=blue>import</font> struts.form.UploadsActionForm;<br><font size=2 color=blue>import</font> org.apache.struts.upload.FormFile;<br><font size=2 color=blue>import</font> java.io.*;<br></font><font size=2 color="#0000aa"><i>/** <br> * MyEclipse Struts<br> * Creation date: 06-11-2006<br> * <br> * XDoclet definition:<br> * @struts.action path="/uploadsAction" name="uploadsActionForm" input="/form/uploadsAction.jsp" scope="request" validate="true"<br> */</font></i><font size=2 color=black><br><font size=2 color=blue>public</font> <font size=2 color=blue>class</font> UploadsActionAction <font size=2 color=blue>extends</font> Action {<br><br>	</font><font size=2 color="#0000aa"><i>// --------------------------------------------------------- Instance Variables</font></i><font size=2 color=black><br><br>	</font><font size=2 color="#0000aa"><i>// --------------------------------------------------------- Methods</font></i><font size=2 color=black><br><br>	</font><font size=2 color="#0000aa"><i>/** <br>	 * Method execute<br>	 * @param mapping<br>	 * @param form<br>	 * @param request<br>	 * @param response<br>	 * @return ActionForward<br>	 */</font></i><font size=2 color=black><br>		</font><font size=2 color="#0000aa"><i>//UploadsActionForm uploadsActionForm = (UploadsActionForm) form;</font></i><font size=2 color=black><br>	<font size=2 color=blue>public</font> ActionForward execute(ActionMapping mapping,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActionForm form,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletRequest request,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpServletResponse response)<br><font size=2 color=red>throws</font> Exception {<br><br><font size=2 color=red>String</font> encoding = request.getCharacterEncoding();<br><font size=2 color=blue>if</font> ((encoding != <font size=2 color=blue>null</font>) &#38;&#38; (encoding.equalsIgnoreCase(</font><font size=2 color="#00bb00">"utf-8"</font><font size=2 color=black>)))<br>{<br>response.setContentType(</font><font size=2 color="#00bb00">"text/html; charset=gb2312"</font><font size=2 color=black>);</font><font size=2 color="#0000aa"><i>//如果没有指定编码，编码格式为gb2312</font></i><font size=2 color=black><br>}<br>UploadsActionForm theForm = (UploadsActionForm ) form;<br>FormFile file = theForm.getFiles();</font><font size=2 color="#0000aa"><i>//取得上传的文件</font></i><font size=2 color=black><br><font size=2 color=blue>try</font> {<br>InputStream stream = file.getInputStream();</font><font size=2 color="#0000aa"><i>//把文件读入</font></i><font size=2 color=black><br><font size=2 color=red>String</font> filePath = request.getRealPath(</font><font size=2 color="#00bb00">"/upload"</font><font size=2 color=black>);</font><font size=2 color="#0000aa"><i>//上传到指定的upload包中</font></i><font size=2 color=black><br>ByteArrayOutputStream baos = <font size=2 color=blue>new</font> ByteArrayOutputStream();<br>OutputStream bos = <font size=2 color=blue>new</font> FileOutputStream(filePath + </font><font size=2 color="#00bb00">"/"</font><font size=2 color=black> +<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file.getFileName());</font><font size=2 color="#0000aa"><i>//建立一个上传文件的输出流</font></i><font size=2 color=black><br></font><font size=2 color="#0000aa"><i>//System.out.println(filePath+"/"+file.getFileName());</font></i><font size=2 color=black><br><font size=2 color=blue>int</font> bytesRead = 0;<br>byte&#91;&#93; buffer = <font size=2 color=blue>new</font> byte&#91;8192&#93;;<br><font size=2 color=blue>while</font> ( (bytesRead = stream.read(buffer, 0, 8192)) != -1) {<br>bos.write(buffer, 0, bytesRead);</font><font size=2 color="#0000aa"><i>//将文件写入服务器</font></i><font size=2 color=black><br>}<br>bos.close();<br>stream.close();<br>}<font size=2 color=blue>catch</font>(Exception e){<br>System.err.print(e);<br>}<br></font><font size=2 color="#0000aa"><i>//request.setAttribute("dat",file.getFileName());</font></i><font size=2 color=black><br><font size=2 color=blue>return</font> mapping.findForward(</font><font size=2 color="#00bb00">"display"</font><font size=2 color=black>);<br><br>}<br><br>}<br><br>UploadsActionForm.java<br><br></font><font size=2 color="#0000aa"><i>//Created by MyEclipse Struts</font></i><font size=2 color=black><br></font><font size=2 color="#0000aa"><i>// XSL source (default): platform:/plugin/com.genuitec.eclipse.cross.easystruts.eclipse_4.1.1/xslt/JavaClass.xsl</font></i><font size=2 color=black><br><br><font size=2 color=blue>package</font> struts.form;<br><br><font size=2 color=blue>import</font> org.apache.struts.action.ActionForm;<br><font size=2 color=blue>import</font> org.apache.struts.upload.FormFile;<br><br></font><font size=2 color="#0000aa"><i>/** <br> * MyEclipse Struts<br> * Creation date: 06-11-2006<br> * <br> * XDoclet definition:<br> * @struts.form name="uploadsActionForm"<br> */</font></i><font size=2 color=black><br><font size=2 color=blue>public</font> <font size=2 color=blue>class</font> UploadsActionForm <font size=2 color=blue>extends</font> ActionForm {<br>	&nbsp;&nbsp;</font><font size=2 color="#0000aa"><i>//public static final String ERROR_PROPERTY_MAX_LENGTH_EXCEEDED = "org.apache.struts.webapp.upload.MaxLengthExceeded";</font></i><font size=2 color=black><br><br>	</font><font size=2 color="#0000aa"><i>// --------------------------------------------------------- Instance Variables</font></i><font size=2 color=black><br><br>	</font><font size=2 color="#0000aa"><i>/** theFile property */</font></i><font size=2 color=black><br>	<font size=2 color=blue>protected</font> FormFile files;<br><br>	</font><font size=2 color="#0000aa"><i>// --------------------------------------------------------- </font></i><font size=2 color=black><br><br>	</font><font size=2 color="#0000aa"><i>/** <br>	 * Returns files.<br>	 * @return FormFile<br>	 */</font></i><font size=2 color=black><br>	<font size=2 color=blue>public</font> FormFile getFiles() {<br>		<font size=2 color=blue>return</font> files;<br>	}<br><br>	</font><font size=2 color="#0000aa"><i>/** <br>	 * Set the files.<br>	 * @param files The files to set<br>	 */</font></i><font size=2 color=black><br>	<font size=2 color=blue>public</font> <font size=2 color=blue>void</font> setFiles(FormFile file) {<br>		<font size=2 color=blue>this</font>.files = file;<br>	}<br><br>}<br><br>上传用的页面:uploadFile.jsp<br> <br>&#60;%@ page language=</font><font size=2 color="#00bb00">"java"</font><font size=2 color=black>%&#62;<br>&#60;%@ taglib uri=</font><font size=2 color="#00bb00">"/WEB-INF/struts-html.tld"</font><font size=2 color=black> prefix=</font><font size=2 color="#00bb00">"html"</font><font size=2 color=black>%&#62;<br> <br>&#60;html&#62; <br>	&#60;head&#62;<br>		&#60;title&#62;JSP <font size=2 color=blue>for</font> uploadsActionForm <font size=2 color=blue>for</font>m&#60;/title&#62;<br>	&#60;/head&#62;<br>	&#60;body&#62;<br>		&#60;html:form action=</font><font size=2 color="#00bb00">"/uploadsAction"</font><font size=2 color=black> enctype=</font><font size=2 color="#00bb00">"multipart/form-data"</font><font size=2 color=black>&#62; &#60;1&#62;<br>			theFile : &#60;html:file property=</font><font size=2 color="#00bb00">"files"</font><font size=2 color=black>/&#62;&#60;br/&#62;<br>			&#60;html:submit/&#62;&#60;html:cancel/&#62;<br>		&#60;/html:form&#62;<br>	&#60;/body&#62;<br>&#60;/html&#62;<br>刚开始&#60;1&#62;处落下了</font><font size=2 color="#00bb00">"enctype="</font><font size=2 color=black>multipart/form-data</font><font size=2 color="#00bb00">" 费了我不少时间才搞定.<br></pre><BR>
</div>

<span id="If_0">
<div class="postFoot">
lunzi &nbsp;
2006-06-11 15:32:11
评论:12 &nbsp;
阅读:14474 &nbsp;
引用:0 
</div>
</span>

<div id="cmt">


<span id="postCmt"> 
<div class="postTitle">
hehe
@2008-10-28 22:37:37 &nbsp;yff
</div>
<div class="postText">
很好多谢多谢！
</div>

</span><span id="postCmt_0"> 
<div class="postTitle">
无题
@2008-10-21 10:32:28 &nbsp;lunzi
</div>
<div class="postText">
是从网上抄的文头早声明了，当时学习测试用的。现在我看这程序也觉得挺烂的，但是这是学习的一个必经过程。。。
</div>

</span><span id="postCmt_1"> 
<div class="postTitle">
菜鸟 
@2008-10-21 09:38:20 &nbsp;AA
</div>
<div class="postText">
垃圾程序。。。一看就是抄书的！！！
</div>

</span><span id="postCmt_2"> 
<div class="postTitle">
不觉得奇怪
@2008-09-06 18:28:38 &nbsp;lunzi
</div>
<div class="postText">
这程序是我06年测试通过的，现在都08年都过了一半了，这种用法应该被更好的方式取代了。
</div>

</span><span id="postCmt_3"> 
<div class="postTitle">
无题
@2008-09-06 17:20:47 &nbsp;
</div>
<div class="postText">
MyEclipse提示:<br/>ByteArrayOutputStream baos = new ByteArrayOutputStream();没用到<br/>request.getRealPath("/upload"); 已经过时<br/><br/>怎么??
</div>

</span><span id="postCmt_4"> 
<div class="postTitle">
无题
@2008-07-31 23:01:41 &nbsp;lunzi
</div>
<div class="postText">
我对程序调试的感觉，确实是如果想实现一个东西，不管过程多令人头痛，当调出的那一刻确实比较舒服。我想喜欢编程的爱好者都有同感吧！！sturts1我已经两年多没用了，后来者最好直接学习struts2的，那个更简单好用！！
</div>

</span><span id="postCmt_5"> 
<div class="postTitle">
asd
@2008-07-31 17:41:47 &nbsp;yingmu
</div>
<div class="postText">
是不是很有成就感啊 哈哈我也想测试一下
</div>

</span><span id="postCmt_6"> 
<div class="postTitle">

@2008-03-27 09:35:54 &nbsp;游客
</div>
<div class="postText">
&nbsp;&nbsp; 我在struts中实现文件上传,&nbsp;&nbsp;包含文本域及文件域,&nbsp;&nbsp; <br/><br/>formBean 中文本域可以填充,&nbsp;&nbsp; 文件域不能填充,&nbsp;&nbsp;为null,<br/><br/>请问这是为什么,&nbsp;&nbsp;还需要配置什么吗<br/>
</div>

</span><span id="postCmt_7"> 
<div class="postTitle">
大文件的问题
@2007-12-26 11:50:28 &nbsp;chris_in
</div>
<div class="postText">
你试过传一个500M的文件 会出什么效果吗，唉，搜了半天都没个解决的办法，我上传一个大文件 页面 就不动了，等了好一段时间后，debug一下 发现 formfile对象 就变成null 了 ，不知为何？
</div>

</span><span id="postCmt_8"> 
<div class="postTitle">

@2007-12-17 16:40:49 &nbsp;游客
</div>
<div class="postText">
成功了&nbsp;&nbsp;记得要在根目录下建文件夹 否则找不到路径
</div>

</span><span id="postCmt_9"> 
<div class="postTitle">
自己调一下就ok了
@2006-11-04 11:32:32 &nbsp;haohao
</div>
<div class="postText">
出现空指针的问题,你可以追踪一下，看是file是null吧!<BR>&nbsp;&nbsp; 是的话,说明配置有问题.actionfrom有问题
</div>

</span><span id="postCmt_10"> 
<div class="postTitle">
急
@2006-11-03 01:53:24 &nbsp;meifly
</div>
<div class="postText">
InputStream stream = file.getInputStream(); //把文件读入<BR>出现&nbsp;&nbsp; 空指针&nbsp;&nbsp;有可能是什么原因
</div>

</span>

</div>

<span id="If_1">
<div id="cmtForm">
<form action="/addCmtAction.do" method="POST">
 <input type="hidden" name="enc" value="卓">
 <input value="61752" name="objectId" type="hidden" id="Any_17"></input>
 <input value="/lunzi/61752.html" name="url" type="hidden" id="Any_18"></input>
 <input value="100" name="type" type="hidden" id="Any_19"></input>
 <input value="2" name="cmt" type="hidden" id="Any_20"></input>
  <h2>  发表评论&gt;&gt; </h2>
<p>  
<input  type="checkbox" name="autoLogin" value="1"  />
 署名发表(评论可管理,不必输入下面的姓名)</p>

  <p>  姓名：  <input name="name" value="" />  </p>
  <p>  主题： <input name="subject"  size="45"  value="" /> <p>
  <p>   内容： 最少15个,最长1000个字符 </p>
  <p>  <textarea name="body"  cols="50" rows="8">
   </textarea> </p>
   
<p>验证码： <input name="digit" size="6"/><img border=0 src="/security/noSpam"/>
 (如不清楚，请刷新）</p>
<p>  <input type="submit" value="提交"/> 
     <input type="reset"  value ="重写"/>  </p>
</form>
</div>
</span> 

</div>
</div>


<div id="powered">
 Copyright@2008 powered by YuLog
 </div>



</div>
</div>
</body>
</html>
