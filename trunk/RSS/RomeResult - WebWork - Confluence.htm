<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
            <title>RomeResult - WebWork - Confluence</title>
            
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Expires" CONTENT="-1">
    <script language="javascript">
      var contextPath = '';
    </script>
            <link rel="stylesheet" href="/styles/main-action.css?spaceKey=WW" type="text/css" />
            <link rel="shortcut icon" href="/images/icons/favicon.ico">
    <link rel="icon" type="image/png" href="/images/icons/favicon.png">
    <script src="/decorators/effects.js"></script>


        

    
</head>

            <body onload="placeFocus()">
    

<div id="PageContent">

    <table border="0" cellpadding="0" cellspacing="0" width="100%">

                <tr class="topBar">
            <td align="left" width="85%">
                &nbsp;
                <span class="topBarDiv">             
    <script language="JavaScript">
        function showBreadcrumbsEllipsis()
        {
            document.getElementById('breadcrumbsEllipsis').style.display = 'none';
            document.getElementById('breadcrumbsExpansion').style.display = 'inline';
        }
    </script>

                <a href="/dashboard.action">Dashboard</a>
     &gt;

                        <a href="/display/WW">WebWork</a> &gt;
        
        
        
        
        
                                    <span id="breadcrumbs"><span id="breadcrumbsEllipsis"/><a href="#" onclick="showBreadcrumbsEllipsis();return false;" title="WebWork&nbsp;&gt;&nbsp;Misc">...</a></span><span id="breadcrumbsExpansion" style="display:none;"><a href='/display/WW/WebWork'>WebWork</a>&nbsp;&gt;&nbsp;<a href='/display/WW/Misc'>Misc</a></span>&nbsp;&gt;&nbsp;</span><a href='/display/WW/Cookbook'>Cookbook</a>&nbsp;&gt;&nbsp;<a href="/display/WW/RomeResult">RomeResult</a>
                                                                        
     </span>
            </td>

            <td align="right" valign="middle" width="1%" nowrap>
                    <form method="POST" action="/dosearchsite.action" name="searchForm" style="padding: 1px; margin: 1px">
        <input type="hidden" name="quickSearch" value="true" />
        
        <input type="hidden" name="searchQuery.spaceKey" value="conf_global" />
        <input type="text" accessKey="s" name="searchQuery.queryString" size="25"/>
        <input type="submit" value="Search"/>
    </form>
            </td>
        </tr>
        
                <tr>
            <td style="padding: 5px" colspan="2">
            <table style="padding: 0px; margin: 0px 5px; width: 100%;" cellspacing="0" cellpadding="1" border="0">
                <tr>
										<td rowspan="2" valign="bottom" width="1%"><a href="/homepage.action"><img src="/images/confluence_logo.gif" align="absmiddle" border="0"></a></td>
										<td valign="bottom" align="left" width="1%" nowrap>&nbsp;
                        <span class="logoSpaceLink">            <a href="/display/WW">WebWork</a>    </span>
                    </td>
                    <td align="right" valign="top" width="98%">
                                                    
    <span class="smalltext">
                    

            <a href="/login.action?os_destination=%2Fdisplay%2FWW%2FRomeResult">Log In</a>

                        </span>
    						
						        <a href="/display/WW/RomeResult?decorator=printable" rel="nofollow"><img src="/images/icons/print_16.gif" width="16" height="16" hspace="1" vspace="1" align="absmiddle" border="0" alt="View a printable version of the current page." title="View a printable version of the current page."/></a>

                                                        
            <a href="/pages/doexportpage.action?pageId=6489&type=TYPE_PDF" rel="nofollow">
        <img src="/images/icons/attachments/pdf.gif" height="16" width="16" border="0" align="absmiddle" title="Export Page as PDF"></a>
                                                                                &nbsp;
                    </td>
                </tr>
                <tr>
                    <td height="22" align="left" colspan="2">&nbsp;
                        <span class="pagetitle" style="line-height: 1; margin: 0px; text-decoration: none">
                                        RomeResult
                            </span>
                    </td>
                </tr>
            </table>
            </td>
        </tr>
            </table>

        <!--
    Root decorator: all decisions about how a page is to be decorated via the
                    inline decoration begins here.
-->



<!--
    Switch based upon the context. However, for now, just delegate to a decorator
    identified directly by the context.
-->


    
    


    
    
        
    
    
<table border="0" cellpadding="0" cellspacing="0" width="100%">

    <tr>
        <td>
            <div class="greynavbar">
                <span style="float:right; padding: 6px 10px 4px 0px">
								
					<a href="/spaces/browsespace.action?key=WW"><img src="/images/icons/browse_space.gif" height="16" width="16" border="0" align="absmiddle" title="Browse Space"></a>&nbsp;<a href="/spaces/browsespace.action?key=WW">Browse Space</a>
							</span>

				<ul id="foldertab" style="margin-bottom: 0px; padding-top: 10px;">
											<li><a  id="viewPageLink"  href="/display/WW/RomeResult"  class="current"    accessKey="v">View</a></li>
											<li><a  id="viewPageLink"  href="/pages/pageinfo.action?pageId=6489"    accessKey="i"><u>I</u>nfo</a></li>
									</ul>
            </div>
        </td>
    </tr>
    <tr>
        <td valign="top" class="pagebody">

                        <table width="100%" cellpadding="0" cellspacing="0" border="0" style="clear: both">
                <tr>
                    <td width='100%' class="pagecontent" valign="top">

                    
                    
                                                                        
                            <table width="100%" style="margin-bottom: 5px" cellspacing="0">
                                <tr>
                                    <td align="left" valign="top">
                                        <span class="smalltext">
                                                        Added by     <a href="/display/~phil">Philip Luppens</a>, last edited by     <a href="/display/~phil">Philip Luppens</a> on Dec 13, 2005
                      
                                            
 
<style type="text/css">
div.auto_complete {
    width: 350px;
    background: #fff;
}

div.auto_complete ul {
    border: 1px solid #888;
    margin: 0;
    padding: 0;
    width: 100%;
    list-style-type: none;
}

div.auto_complete ul li {
    margin: 0;
    padding: 3px;
}

div.auto_complete ul li.selected {
    background-color: #ffb;
}

div.auto_complete ul strong.highlight {
    color: #800;
    margin: 0;
    padding: 0;
}
</style>


<!-- Delay the loading of the external javascript file needed for labels (as it takes too long to load and visibly holds loading of the page body) -->
<!-- To do this without javascript errors over undefined functions, we need to declare stubs here (that are overrided later by the proper implementations) -->
<script language="JavaScript" type="text/javascript">
    function doAddLabel(hideTextfieldAfterAddParam)
    {
        // stub
    }

    function onAddLabel()
    {
        // stub
    }

    function showLabelsInput()
    {
        // stub
    }
</script>

<!-- This is a hack to work around an apparent SiteMesh bug - http://jira.opensymphony.com/browse/SIM-198 -->


<span class="error"><span class="errorMessage" id="errorSpan"></span></span>
<form name="addLabelForm" method="" action="" onSubmit="doAddLabel(false); return false;" style="margin: 0px; padding: 0px">
    <div style="float: left">Labels:&nbsp;</div>
    <div id="labelsInfo" style="float: left; width: 90%">
        <span id="labelsList">
                    (None)
                </span>
            </div>
    <br clear="all"/><!-- Do not remove this line-break. You will make Safari cry. -->
    <div id="labelInputSpan" style="display: none; clear: both;">
        <br/>
        <div style="border: 1px solid #cccccc; padding: 8px; align: center; background-color: #f0f0f0">

        <div id="labelOperationErrorContainer" style="display: none"><span class="error"><span class="errorMessage" id="labelOperationErrorMessage"></span></span></div>

        <table width="100%">
            <tr>
                <td>
                    <div class="formtitle" style="padding-bottom: 3px; font-size: 13px;">Add Labels</div>
                </td>
                <td align="right"><div id="waitImageAndStatus" style="display: none; height: 16px;"><img alt="Wait Image" border=0 align="absmiddle" src="/images/icons/wait.gif">&nbsp;<span id="labelOperationStatus" class="smalltext" style="vertical-align: middle"></span></div></td>
            </tr>
            <tr><td width="50%">
                    Enter labels to add to this page:<br/>
        <input autocomplete="off" type="text" id="labelName" name="labelsString" value="" class="monospaceInput" size="40">
        <input type="submit" onclick="doAddLabel(false); return false;" value="Add"><input type="button" onclick="doAddLabel(true); return false;" value="Done">
        <div class="auto_complete" id="labelsAutocompleteList"></div>
        <div class="smalltext">
            <em>Tip:</em> Looking for a label? Just start typing.
        </div>
        </td>
            <td width="50%" valign="top">
                <div id="suggestedLabelsSpan"></div>
            </td>
        </tr></table>
        </div>
    </div>
</form>
    <script type="text/javascript">
        // if there is javascript support, enable the [Edit] link that enables AJAX label adding/removing functionality
        if (document.getElementById('editLabelsLink'))
        {
            document.getElementById('editLabelsLink').style.display = 'inline';
        }
    </script>
                                        </span>
                                    </td>
                                    <td align="right" valign="top">
                                                                            </td>
                                </tr>
                            </table>

                            
                            <div class="wiki-content">
                               <!-- wiki content -->
            <h2><a name="RomeResult-Introduction"></a>Introduction</h2>

<p>A couple of days ago I quickly had to create a WW result type that would transform a Rome (<span class="nobr"><a href="https://rome.dev.java.net/" title="Visit page outside Confluence" rel="nofollow">https://rome.dev.java.net/<sup><img class="rendericon" src="/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span>) SyndFeed to several news feeds. WW makes this very, very easy. </p>
<table cellpadding='5' width='85%' cellspacing='8px' class='infoMacro' border="0" align='center'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="/images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b class="strong">Used versions</b><br />
<p>WebWork 2.2 beta 4<br/>
Rome 0.7 beta</p></td></tr></table>

<h2><a name="RomeResult-Thecode"></a>The code</h2>

<div class="code"><div class="codeHeader"><b>com.acme.result.RomeResult.java</b></div><div class="codeContent">
<pre class="code-java">/**
 * 
 */
<span class="code-keyword">package</span> com.acme.result;

<span class="code-keyword">import</span> java.io.Writer;

<span class="code-keyword">import</span> org.apache.log4j.Logger;

<span class="code-keyword">import</span> com.opensymphony.webwork.ServletActionContext;
<span class="code-keyword">import</span> com.opensymphony.xwork.ActionInvocation;
<span class="code-keyword">import</span> com.opensymphony.xwork.Result;
<span class="code-keyword">import</span> com.sun.syndication.feed.synd.SyndFeed;
<span class="code-keyword">import</span> com.sun.syndication.io.SyndFeedOutput;

/**
 * A simple Result to output a Rome SyndFeed object into a newsfeed.
 * @author Philip Luppens
 * 
 */
<span class="code-keyword">public</span> class RomeResult <span class="code-keyword">implements</span> Result {

	<span class="code-keyword">private</span> <span class="code-object">String</span> feedName;

	<span class="code-keyword">private</span> <span class="code-object">String</span> feedType;

	<span class="code-keyword">private</span> <span class="code-keyword">final</span> <span class="code-keyword">static</span> Logger logger = Logger.getLogger(RomeResult.class);

	/*
	 * (non-Javadoc)
	 * 
	 * @see com.opensymphony.xwork.Result#execute(com.opensymphony.xwork.ActionInvocation)
	 */
	<span class="code-keyword">public</span> void execute(ActionInvocation ai) <span class="code-keyword">throws</span> Exception {
		<span class="code-keyword">if</span> (feedName == <span class="code-keyword">null</span>) {
			<span class="code-comment">// ack, we need <span class="code-keyword">this</span> to find the feed on the stack
</span>			logger
					.error(<span class="code-quote">"Required parameter 'feedName' not found. "</span>
							+ <span class="code-quote">"Make sure you have the param tag set and "</span>
							+ <span class="code-quote">"the <span class="code-keyword">static</span>-parameters interceptor enabled in your interceptor stack."</span>);
			<span class="code-comment">// no point in continuing ..
</span>			<span class="code-keyword">return</span>;
		}

		<span class="code-comment">// don't forget to set the content to the correct mimetype
</span>		ServletActionContext.getResponse().setContentType(<span class="code-quote">"text/xml"</span>);
		<span class="code-comment">// get the feed from the stack that can be found by the feedName
</span>		SyndFeed feed = (SyndFeed) ai.getStack().findValue(feedName);

		<span class="code-keyword">if</span> (logger.isDebugEnabled()) {
			logger.debug(<span class="code-quote">"Found object on stack with name '"</span> + feedName + <span class="code-quote">"': "</span>
					+ feed);
		}
		<span class="code-keyword">if</span> (feed != <span class="code-keyword">null</span>) {

			<span class="code-keyword">if</span> (feedType != <span class="code-keyword">null</span>) {
				<span class="code-comment">// Accepted types are: rss_0.90 - rss_2.0 and atom_0.3
</span>				<span class="code-comment">// There is a bug though in the rss 2.0 generator when it checks
</span>				<span class="code-comment">// <span class="code-keyword">for</span> the type attribute in the description element. It's has a
</span>				<span class="code-comment">// big 'FIXME' next to it (v. 0.7beta).
</span>				feed.setFeedType(feedType);
			}
			SyndFeedOutput output = <span class="code-keyword">new</span> SyndFeedOutput();
			<span class="code-comment">//we'll need the writer since Rome doesn't support writing to an outputStream yet
</span>			Writer out = <span class="code-keyword">null</span>;
			<span class="code-keyword">try</span> {
				out = ServletActionContext.getResponse().getWriter();
				output.output(feed, out);
			} <span class="code-keyword">catch</span> (Exception e) {
				<span class="code-comment">// Woops, couldn't write the feed ?
</span>				logger.error(<span class="code-quote">"Could not write the feed"</span>, e);
			} <span class="code-keyword">finally</span> {
				<span class="code-comment">//close the output writer (will flush automatically)
</span>				<span class="code-keyword">if</span> (out != <span class="code-keyword">null</span>) {
					out.close();
				}
			}

		} <span class="code-keyword">else</span> {
			<span class="code-comment">// woops .. no object found on the stack with that name ?
</span>			logger.error(<span class="code-quote">"Did not find object on stack with name '"</span> + feedName
					+ <span class="code-quote">"'"</span>);
		}
	}

	<span class="code-keyword">public</span> void setFeedName(<span class="code-object">String</span> feedName) {
		<span class="code-keyword">this</span>.feedName = feedName;
	}

	<span class="code-keyword">public</span> void setFeedType(<span class="code-object">String</span> feedType) {
		<span class="code-keyword">this</span>.feedType = feedType;
	}

}</pre>
</div></div>

<h2><a name="RomeResult-CodeExplanation"></a>Code Explanation</h2>

<p>Easy enough. We try to find the SyndFeed object on the WW stack. If we can find it, we will set the feed type (rss v0.9 +, atom 0.3) if it has been specified in the result parameters (see below). Then we use a SyndFeedOutput to write our newsfeed to our PrintWriter from our response.</p>

<h2><a name="RomeResult-XWorkconfiguration"></a>XWork configuration</h2>

<p>Before you can use this result, you will need to register it in your xwork.xml:</p>
<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;package name=<span class="code-quote">"default"</span> extends=<span class="code-quote">"webwork-default"</span>&gt;</span>
	<span class="code-tag">&lt;result-types&gt;</span>
		<span class="code-tag">&lt;result-type name=<span class="code-quote">"feed"</span> class=<span class="code-quote">"com.acme.result.RomeResult"</span>/&gt;</span>
	<span class="code-tag">&lt;/result-types&gt;</span>
	<span class="code-tag">&lt;interceptors&gt;</span>
..</pre>
</div></div>

<p>You can now use this result type. So, create an Action that will create and populate the Rome SyndFeed, and make sure you provide a getter for your populated SyndFeed. The actual creation of your feed is beyond this recipe, but you can find plenty of examples in the Rome Wiki (<span class="nobr"><a href="http://wiki.java.net/bin/view/Javawsxml/Rome05Tutorials" title="Visit page outside Confluence" rel="nofollow">http://wiki.java.net/bin/view/Javawsxml/Rome05Tutorials<sup><img class="rendericon" src="/images/icons/linkext7.gif" height="7" width="7" align="absmiddle" alt="" border="0"/></sup></a></span>).</p>

<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;action name=<span class="code-quote">"feed"</span> class=<span class="code-quote">"com.acme.action.CreateFeedAction"</span>&gt;</span>
	<span class="code-tag">&lt;result name=<span class="code-quote">"success"</span> type=<span class="code-quote">"feed"</span>&gt;</span>
		<span class="code-tag">&lt;param name=<span class="code-quote">"feedName"</span>&gt;</span>feed<span class="code-tag">&lt;/param&gt;</span>
		<span class="code-tag">&lt;param name=<span class="code-quote">"feedType"</span>&gt;</span>rss_1.0<span class="code-tag">&lt;/param&gt;</span>
	<span class="code-tag">&lt;/result&gt;</span>
<span class="code-tag">&lt;/action&gt;</span></pre>
</div></div>

<h2><a name="RomeResult-Concludingthoughts"></a>Concluding thoughts</h2>

<p>This is a simple feed result using Rome as a news feed generator. You might want to make sure you don't generate your feed on every request, but there are lots of ways to deal with such problems. You can also provide additional setters in the Result to set your feed title, url, etc, but this should suffice for a quickstart.</p>
                            </div>

                            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
    rdf:about="http://wiki.opensymphony.com/display/WW/RomeResult"
    dc:identifier="http://wiki.opensymphony.com/display/WW/RomeResult"
    dc:title="RomeResult"
    trackback:ping="http://wiki.opensymphony.com/rpc/trackback/6489"/>
</rdf:RDF>
-->

                            
                    
                                <!--
    Root decorator: all decisions about how a page is to be decorated via the
                    inline decoration begins here.
-->



<!--
    Switch based upon the context. However, for now, just delegate to a decorator
    identified directly by the context.
-->


    
    

<div class="wiki-content" style="margin-right:10px;">
    <p style="clear: both"/><!-- comments should always display underneath the content. we should have a 'clear:both' here just in case there are floats or aligned images in the content -->

    
            <div class="tabletitle" style="border: 0px">
            <a name="comments">Comments</a>
                        <span class="smalltext">&nbsp;(<a href="/display/WW/RomeResult?showComments=false">Hide</a>)</span>
                    </div>
    
    
            
                                <div style="padding: 0 0 0  0 ">
        <a name="comment-7670"></a>
        <div  class="commentBox" style="background-color: ">
            <div class="commentblock"><p>Good day,</p>

<p>&nbsp;This is exactly what I am looking for &#33; <img class="emoticon" src="/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/> Nice recipe you guys have hear &#33; <img class="emoticon" src="/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"/></p>

<p>&nbsp;I have a question though about this line:</p>

<div class="code"><div class="codeContent">
<pre class="code-java">SyndFeed feed = (SyndFeed) ai.getStack().findValue(feedName);</pre>
</div></div>
<p>&nbsp;Does that mean that an object of type SyndFeed must be pushed to the stack (ww:push) prior to the execution of the Action that will used this RomeResult?</p>

<p>Thanks a bunch,<br/>
Franz&nbsp;</p></div>
            <div align="left" class="smallfont" style="color: #666666; width: 98%">
                <img src="/images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                Posted by     <a href="/display/~franz%2Bsee">franz allan valencia see</a> at Sep 13, 2006 19:58
                                  |
                  <a href="/display/WW/RomeResult?focusedCommentId=7670#comment-7670">Permalink</a>

                                                                </div>

            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
    rdf:about="http://wiki.opensymphony.com/display/WW/RomeResult?focusedCommentId=7670#comment-7670"
    dc:identifier="http://wiki.opensymphony.com/display/WW/RomeResult?focusedCommentId=7670#comment-7670"
    dc:title="$comment.title"
    trackback:ping="http://wiki.opensymphony.com/rpc/trackback/7670"/>
</rdf:RDF>
-->

                    </div>

            </div>
                                <div style="padding: 0 0 0  0 ">
        <a name="comment-8571"></a>
        <div  class="commentBox" style="background-color: ">
            <div class="commentblock"><p>it simply means there has to be a get'feedName'() method on the top of the stack (mostly on your Action).</p></div>
            <div align="left" class="smallfont" style="color: #666666; width: 98%">
                <img src="/images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                Posted by     <a href="/display/~phil">Philip Luppens</a> at Jan 03, 2007 08:15
                                  |
                  <a href="/display/WW/RomeResult?focusedCommentId=8571#comment-8571">Permalink</a>

                                                                </div>

            <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
    rdf:about="http://wiki.opensymphony.com/display/WW/RomeResult?focusedCommentId=8571#comment-8571"
    dc:identifier="http://wiki.opensymphony.com/display/WW/RomeResult?focusedCommentId=8571#comment-8571"
    dc:title="$comment.title"
    trackback:ping="http://wiki.opensymphony.com/rpc/trackback/8571"/>
</rdf:RDF>
-->

                    </div>

            </div>
            
            
                                    </div>



                                                            </td>


                                                    </tr>
        </table>

        
        </td>
    </tr>
</table>

    </div>

  	                                                    <div class="license-nonprofit">
                    Site powered by a free <b>Open Source Project / Non-profit License</b> (<a href="http://www.atlassian.com/c/conf/10138">more</a>) of <b><a href="http://www.atlassian.com/c/conf/10137">Confluence - the Enterprise wiki</a>.<br/> <a href="http://www.atlassian.com/c/conf/10137">Learn more</a> or <a href="http://www.atlassian.com/c/conf/10137">evaluate Confluence for your organisation</a>.
                    </div>
                                            <div class="bottomshadow"></div>
  	<div id="poweredby" class="smalltext">
		Powered by <a href="http://www.atlassian.com/wiki/?clicked=footer" class="smalltext">Atlassian Confluence</a>, the <a href="http://www.atlassian.com/wiki/?clicked=footer" class="smalltext">Enterprise Wiki</a>. (Version: 2.2.9 Build:#527 Sep 07, 2006)
		-
		<a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" class="smalltext">Bug/feature request</a>
		-
		<a href="/administrators.action">Contact Administrators</a>
		<br/>
	</div>

<!-- delay the loading of large javascript files to the end so that they don't interfere with the loading of page content -->
<span style="display: none">
    <script type="text/javascript" language="JavaScript">var domainName = 'http://wiki.opensymphony.com'; var entityId = '6489'; var spaceKey = 'WW'</script>
    <script type="text/javascript" language="JavaScript" src="/labels-javascript"></script>
    <script>new Ajax.Autocompleter('labelName', 'labelsAutocompleteList', '6489', { tokens: new Array(',', ' '), dwrFunction: GenerateAutocompleteLabelsListForEntity.autocompleteLabels});</script>
</span>


</body>
</html>